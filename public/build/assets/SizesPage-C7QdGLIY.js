import{_ as x}from"./AuthenticatedLayout-BB4oSw7V.js";import"./CalcForm-YklUsYCh.js";import{o as i,c as o,b as e,d as m,v as p,e as y,t as h,f as n,F as r,r as _,i as P,g as b,k as T,l as j,p as B,q as D,s as E,w,x as N,y as L,z as $,u as U,a as O,Z as J}from"./app-ClgqYLNi.js";import{_ as Z}from"./MaterialTable-KJ5LhAX3.js";import{P as A,_ as G}from"./SizeTable2.vue_vue_type_style_index_0_lang-C8Xu6rE0.js";import"./ApplicationLogo-BctaxC8V.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RalColorSelector-YfqKdBFi.js";import"./Pagination-C7Xg3IfL.js";const H={class:"row"},K={class:"col-12 col-md-6"},Q={class:"form-floating mb-3"},R=e("label",{for:"size-width"},"Ширина, см",-1),W={class:"col-12 col-md-6"},X={class:"form-floating mb-3"},Y=e("label",{for:"size-height"},"Высота, см",-1),I={class:"row"},ee={class:"col-12 col-md-6"},se={class:"form-floating mb-3"},te=e("label",{for:"size-price-wholesale"},"Цена опт, руб",-1),le={class:"col-12 col-md-6"},ie={class:"form-floating mb-3"},oe=e("label",{for:"size-price-dealer"},"Цена дилеру, руб",-1),ae={class:"col-12 col-md-6"},re={class:"form-floating mb-3"},de=e("label",{for:"size-price-wholesale"},"Цена опт, руб",-1),ne={class:"col-12 col-md-6"},ce={class:"form-floating mb-3"},he=e("label",{for:"size-price-retail"},"Цена розница, руб",-1),me={class:"col-12 col-md-6"},pe={class:"form-floating mb-3"},ue=e("label",{for:"size-price-cost"},"Себестоимость, руб",-1),fe={class:"col-12 col-md-6"},_e={class:"form-floating mb-3"},be=e("label",{for:"size-price-koef"},"Ценовой коэффициент",-1),ge={class:"form-floating mb-3"},ve=e("label",{for:"size-loops-count"},"Число петель",-1),ye={key:0,class:"mb-2"},we=e("i",{class:"fa-solid fa-xmark ml-1 text-danger"},null,-1),$e=[we],ke=e("i",{class:"fa-solid fa-scroll mr-2"},null,-1),Me={class:"row mt-2"},ze={class:"col-12"},Se={class:"alert alert-danger alert-dismissible fade show",role:"alert"},Ce=e("strong",null,"Внимание!",-1),Fe=["onClick"],Ve={class:"row mt-5"},je={class:"col-12 d-flex justify-content-center"},Oe=["disabled"],Ue={key:0,class:"fa-regular fa-floppy-disk mr-1"},qe={key:1,class:"spinner-border spinner-border-sm text-success",role:"status"},xe=e("i",{class:"fa-solid fa-xmark mr-1"},null,-1),Pe={class:"modal fade",id:"select-material-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Te={class:"modal-dialog modal-lg"},Be={class:"modal-content"},De={class:"modal-body"},Ee=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Ne={props:["item"],data(){return{materialModal:null,messages:[],loading:!1,loadingMaterial:!1,selectedMaterial:null,form:{id:null,width:0,height:0,material_id:null,price:{wholesale:0,dealer:0,retail:0,cost:0},price_koef:0,loops_count:0}}},computed:{needClearForm(){return this.form.id||this.form.width||this.form.height||this.form.size_id||this.form.price||this.form.price_koef||this.form.loops_count}},mounted(){this.materialModal=new bootstrap.Modal(document.getElementById("select-material-modal"),{}),this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,width:this.item.width||null,height:this.item.height||null,size_id:this.item.size_id||null,price:this.item.price||{wholesale:0,dealer:0,retail:0,cost:0},price_koef:this.item.price_koef||null,loops_count:this.item.loops_count||null,material_id:this.item.material_id||null},this.selectedMaterial=this.item.material||null})},methods:{removeSelectedMaterial(){this.selectedMaterial=null,this.form.material_id=null},openMaterialModal(){this.materialModal.show()},selectMaterial(a){this.selectedMaterial=a,this.form.material_id=a.id,this.loadingMaterial=!0,this.$nextTick(()=>{this.loadingMaterial=!1}),this.materialModal.hide()},alert(a){this.messages.push(a)},resetForm(){this.form={id:this.item.id||null,width:this.item.width||null,height:this.item.height||null,size_id:this.item.size_id||null,price:this.item.price||{wholesale:0,dealer:0,retail:0,cost:0},price_koef:this.item.price_koef||null,loops_count:this.item.loops_count||null},this.$emit("callback")},removeMessage(a){this.messages.splice(a,1)},submit(){let a=new FormData;Object.keys(this.form).forEach(s=>{const l=this.form[s]||"";typeof l=="object"?a.append(s,JSON.stringify(l)):a.append(s,l)}),this.$store.dispatch("storeSize",{sizeForm:a}).then(s=>{this.resetForm(),this.$emit("callback")}).catch(s=>{s.response?this.alert(s.response.data.message):this.alert("Ошибка")})}}},Le=Object.assign(Ne,{__name:"SizeForm",setup(a){return(s,l)=>(i(),o(r,null,[e("form",{action:"",onSubmit:l[12]||(l[12]=P((...t)=>s.submit&&s.submit(...t),["prevent"]))},[e("div",H,[e("div",K,[e("div",Q,[m(e("input",{type:"number","onUpdate:modelValue":l[0]||(l[0]=t=>s.form.width=t),class:"form-control",id:"size-width",required:""},null,512),[[p,s.form.width]]),R])]),e("div",W,[e("div",X,[m(e("input",{type:"number","onUpdate:modelValue":l[1]||(l[1]=t=>s.form.height=t),class:"form-control",id:"size-height",required:""},null,512),[[p,s.form.height]]),Y])])]),e("div",I,[e("div",ee,[e("div",se,[m(e("input",{type:"number","onUpdate:modelValue":l[2]||(l[2]=t=>s.form.price.wholesale=t),class:"form-control",id:"size-price-wholesale",required:""},null,512),[[p,s.form.price.wholesale]]),te])]),e("div",le,[e("div",ie,[m(e("input",{type:"number","onUpdate:modelValue":l[3]||(l[3]=t=>s.form.price.dealer=t),class:"form-control",id:"size-price-dealer",required:""},null,512),[[p,s.form.price.dealer]]),oe])]),e("div",ae,[e("div",re,[m(e("input",{type:"number","onUpdate:modelValue":l[4]||(l[4]=t=>s.form.price.wholesale=t),class:"form-control",id:"size-price-wholesale",required:""},null,512),[[p,s.form.price.wholesale]]),de])]),e("div",ne,[e("div",ce,[m(e("input",{type:"number","onUpdate:modelValue":l[5]||(l[5]=t=>s.form.price.retail=t),class:"form-control",id:"size-price-retail",required:""},null,512),[[p,s.form.price.retail]]),he])]),e("div",me,[e("div",pe,[m(e("input",{type:"number","onUpdate:modelValue":l[6]||(l[6]=t=>s.form.price.cost=t),class:"form-control",id:"size-price-cost",required:""},null,512),[[p,s.form.price.cost]]),ue])]),e("div",fe,[e("div",_e,[m(e("input",{type:"number","onUpdate:modelValue":l[7]||(l[7]=t=>s.form.price_koef=t),step:"0.1",class:"form-control",id:"size-price-koef",required:""},null,512),[[p,s.form.price_koef]]),be])])]),e("div",ge,[m(e("input",{type:"number","onUpdate:modelValue":l[8]||(l[8]=t=>s.form.loops_count=t),class:"form-control",id:"size-loops-count",placeholder:"name@example.com"},null,512),[[p,s.form.loops_count]]),ve]),s.selectedMaterial?(i(),o("p",ye,[y("Вы выбрали материал: "),e("strong",null,h(s.selectedMaterial.title||"-"),1),e("a",{href:"javascript:void(0)",onClick:l[9]||(l[9]=(...t)=>s.removeSelectedMaterial&&s.removeSelectedMaterial(...t))},$e)])):n("",!0),e("button",{type:"button",class:"btn btn-outline-primary",onClick:l[10]||(l[10]=(...t)=>s.openMaterialModal&&s.openMaterialModal(...t))},[ke,y(" Выберите материал ")]),e("div",Me,[e("div",ze,[s.messages.length>0?(i(!0),o(r,{key:0},_(s.messages,(t,g)=>(i(),o("div",Se,[Ce,y(" "+h(t||"Ошибка")+" ",1),e("button",{type:"button",class:"btn-close",onClick:u=>s.removeMessage(g)},null,8,Fe)]))),256)):n("",!0)])]),e("div",Ve,[e("div",je,[e("button",{disabled:!s.needClearForm||s.form.material_id==null,class:"btn btn-outline-success rounded-5"},[s.loading?(i(),o("span",qe)):(i(),o("i",Ue)),y(" Сохранить размер ")],8,Oe),s.needClearForm&&!s.loading?(i(),o("button",{key:0,type:"button",onClick:l[11]||(l[11]=(...t)=>s.resetForm&&s.resetForm(...t)),class:"btn btn-outline-danger rounded-5 ml-2"},[xe,y(" Очистить форму ")])):n("",!0)])])],32),e("div",Pe,[e("div",Te,[e("div",Be,[e("div",De,[s.loadingMaterial?n("",!0):(i(),b(Z,{key:0,onSelect:s.selectMaterial},null,8,["onSelect"]))]),Ee])])])],64))}}),Je=T({__name:"PerfectScrollbar",props:{tag:{default:"div"},options:{default:()=>({})}},emits:["scroll","ps-scroll-y","ps-scroll-x","ps-scroll-up","ps-scroll-down","ps-scroll-left","ps-scroll-right","ps-y-reach-start","ps-y-reach-end","ps-x-reach-start","ps-x-reach-end"],setup(a,{expose:s,emit:l}){const t=a,g=l,u=j(null),d=j(null);B(()=>t.options,()=>{M(),k()},{deep:!0}),D(()=>{u.value&&k()}),E(()=>{M()});function k(){u.value&&(d.value=new A(u.value,t.options),z())}function M(){d.value&&(z(!1),d.value.destroy(),d.value=null)}const q={scroll:c("scroll"),"ps-scroll-y":c("ps-scroll-y"),"ps-scroll-x":c("ps-scroll-x"),"ps-scroll-up":c("ps-scroll-up"),"ps-scroll-down":c("ps-scroll-down"),"ps-scroll-left":c("ps-scroll-left"),"ps-scroll-right":c("ps-scroll-right"),"ps-y-reach-start":c("ps-y-reach-start"),"ps-y-reach-end":c("ps-y-reach-end"),"ps-x-reach-start":c("ps-x-reach-start"),"ps-x-reach-end":c("ps-x-reach-end")};function c(f){return function(v){g(f,v)}}function z(f=!0){var v;(v=d.value)!=null&&v.element&&Object.entries(q).forEach(([S,C])=>{var F,V;f?(F=d.value)==null||F.element.addEventListener(S,C):(V=d.value)==null||V.element.removeEventListener(S,C)})}return s({ps:d}),(f,v)=>(i(),b(L(f.tag),{ref_key:"scrollbar",ref:u,class:"ps"},{default:w(()=>[N(f.$slots,"default")]),_:3},512))}}),Ze={class:"row"},Ae={class:"col-12"},Ge=["onClick"],He=e("td",{rowspan:"2",class:"table-side-column"},"Высота",-1),Ke=e("td",{rowspan:"2",class:"table-side-column"},"Ширина",-1),Qe={key:0,colspan:"5",width:"200px",style:{"font-weight":"bold","text-align":"center",border:"1px solid #dadada"}},Re=e("td",{width:"100px",style:{"font-weight":"bold","text-align":"center",border:"1px solid #dadada","min-width":"100px"}},"Опт",-1),We=e("td",{width:"100px",style:{"font-weight":"bold","text-align":"center",border:"1px solid #dadada","min-width":"100px"}},"Дилер",-1),Xe=e("td",{width:"100px",style:{"font-weight":"bold","text-align":"center",border:"1px solid #dadada","min-width":"100px"}},"Розница",-1),Ye=e("td",{width:"100px",style:{"font-weight":"bold","text-align":"center",border:"1px solid #dadada","min-width":"100px"}},"Себестоимость",-1),Ie=e("td",{width:"100px",style:{"font-weight":"bold","text-align":"center",border:"1px solid #dadada"}}," Коэффициент ",-1),es={class:"table-side-column"},ss={class:"table-side-column"},ts={style:{"text-align":"center",border:"1px solid #dadada","min-width":"100px"}},ls={style:{"text-align":"center",border:"1px solid #dadada","min-width":"100px"}},is={style:{"text-align":"center",border:"1px solid #dadada","min-width":"100px"}},os={style:{"text-align":"center",border:"1px solid #dadada","min-width":"100px"}},as={width:"100px",style:{"text-align":"center",border:"1px solid #dadada"}},rs={key:1,class:"alert alert-success my-3",role:"alert"},ds=e("h4",{class:"alert-heading"},"Выберите материалы",-1),ns=e("p",null,"Для отображения таблицы выберите интересующие материалы",-1),cs=[ds,ns],hs={key:2,class:"alert alert-success my-3",role:"alert"},ms=e("h4",{class:"alert-heading"},"Размеры",-1),ps=e("p",null,"К сожалению, раздел размеров пуст. Вы еще не добавили ни одного размера, который можно отобразить на этой странице.",-1),us=e("hr",null,null,-1),fs=e("p",{class:"mb-0"},"Воспользуйтесь формой выше и добавьте свой первый размер",-1),_s=[ms,ps,us,fs],bs={data(){return{materials:[],prices:[],selectedMaterials:[]}},mounted(){this.loadSizes()},methods:{toggleMaterialId(a){let s=this.selectedMaterials.findIndex(l=>l===a);s===-1?this.selectedMaterials.push(a):this.selectedMaterials.splice(s,1)},loadSizes(a=0){this.$store.dispatch("loadPreparedPrices").then(s=>{this.materials=s.materials,this.prices=s.prices,this.selectedMaterials=this.materials.map(l=>l.id)}).catch(()=>{})},saveParam(a,s,l){this.$store.dispatch("updateSizeParam",{dataObject:{id:this.prices[s].prices[l].id,key:a,value:this.prices[s].prices[l][a],height:this.prices[s].prices[l].height||null,width:this.prices[s].prices[l].width||null,material_id:this.prices[s].prices[l].material_id||null}}).then(t=>{this.prices[s].prices[l].id||(this.prices[s].prices[l].id=t.data.id),this.$notify({title:"DoDoors",text:"Параметры успешно обновлены"})}).catch(()=>{})}}},gs=Object.assign(bs,{__name:"SizeTable2",setup(a){return(s,l)=>(i(),o(r,null,[e("div",Ze,[e("div",Ae,[(i(!0),o(r,null,_(s.materials,t=>(i(),o("span",{class:$(["badge mr-2 cursor-pointer",{"bg-primary":s.selectedMaterials.indexOf(t.id)!=-1,"bg-secondary":s.selectedMaterials.indexOf(t.id)==-1}]),onClick:g=>s.toggleMaterialId(t.id)},h(t.title),11,Ge))),256))])]),s.prices.length>0&&s.selectedMaterials.length>0?(i(),b(U(Je),{key:0,scrollTop:"",class:"py-2"},{default:w(()=>[e("table",null,[e("thead",null,[e("tr",null,[He,Ke,(i(!0),o(r,null,_(s.materials,t=>(i(),o(r,null,[s.selectedMaterials.indexOf(t.id)!=-1?(i(),o("td",Qe,h(t.title),1)):n("",!0)],64))),256))]),e("tr",null,[(i(!0),o(r,null,_(s.materials,t=>(i(),o(r,null,[s.selectedMaterials.indexOf(t.id)!=-1?(i(),o(r,{key:0},[Re,We,Xe,Ye,Ie],64)):n("",!0)],64))),256))])]),e("tbody",null,[(i(!0),o(r,null,_(s.prices,(t,g)=>(i(),o("tr",null,[e("td",es,[e("span",null,h(t.height),1)]),e("td",ss,[e("span",null,h(t.width),1)]),(i(!0),o(r,null,_(t.prices,(u,d)=>(i(),o(r,null,[s.selectedMaterials.indexOf(u.material_id)!=-1?(i(),o(r,{key:0},[e("td",ts,h(t.prices[d].price.wholesale),1),e("td",ls,h(t.prices[d].price.dealer),1),e("td",is,h(t.prices[d].price.retail),1),e("td",os,h(t.prices[d].price.cost),1),e("td",as,h(t.prices[d].price_koef),1)],64)):n("",!0)],64))),256))]))),256))])])]),_:1})):n("",!0),s.selectedMaterials.length===0?(i(),o("div",rs,cs)):n("",!0),s.prices.length===0?(i(),o("div",hs,_s)):n("",!0)],64))}}),vs=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Размеры",-1),ys={class:"py-12"},ws={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},$s={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ks={class:"p-6 text-gray-900"},Ms=e("hr",{class:"hr my-5"},null,-1),zs={class:"d-flex justify-center my-2"},Ss={class:"nav nav-tabs"},Cs={class:"nav-item"},Fs={class:"nav-item"},Vs={data(){return{tab:0,loading:!1,selectedSize:null}},methods:{selectSize(a){this.selectedSize=a,this.loading=!0,this.$nextTick(()=>{this.loading=!1})},callbackSizeForm(){this.loading=!0,this.selectedSize=null,this.$nextTick(()=>{this.loading=!1})}}},Es=Object.assign(Vs,{__name:"SizesPage",setup(a){return(s,l)=>(i(),o(r,null,[O(U(J),{title:"Размеры"}),O(x,null,{header:w(()=>[vs]),default:w(()=>[e("div",ys,[e("div",ws,[e("div",$s,[e("div",ks,[s.loading?n("",!0):(i(),b(Le,{key:0,item:s.selectedSize,onCallback:s.callbackSizeForm},null,8,["item","onCallback"])),Ms,e("div",zs,[e("ul",Ss,[e("li",Cs,[e("a",{class:$(["nav-link",{active:s.tab===0}]),"aria-current":"page",onClick:l[0]||(l[0]=t=>s.tab=0),href:"javascript:void(0)"},"Таблица размеров",2)]),e("li",Fs,[e("a",{class:$(["nav-link",{active:s.tab===1}]),onClick:l[1]||(l[1]=t=>s.tab=1),href:"javascript:void(0)"},"Сводная таблица",2)])])]),s.tab===0?(i(),o(r,{key:1},[s.loading?n("",!0):(i(),b(G,{key:0,onSelect:s.selectSize},null,8,["onSelect"]))],64)):n("",!0),s.tab===1?(i(),b(gs,{key:2})):n("",!0)])])])])]),_:1})],64))}});export{Es as default};
