import{_ as $}from"./AuthenticatedLayout-B6rLL-Zc.js";import{m as y,o as n,c as i,b as o,f as h,v as m,g as r,e as l,F as _,r as g,d as p,t as a,h as C,a as f,w as b,u as k,j as w,Z as P}from"./app-PaeVRU1m.js";import{P as j}from"./Pagination-dbUYlKos.js";import{E as v}from"./main-9k0xheay.js";import"./ApplicationLogo-Dr8bXOnU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const V={class:"row"},F={class:"col-12"},L={class:"input-group mb-3"},A={class:"form-floating"},I=o("label",{for:"search-promo-codes"},"Поиск по промокодам",-1),D=o("i",{class:"fa-solid fa-magnifying-glass"},null,-1),M=[D],O={style:{"overflow-y":"auto"}},T={key:0,class:"table"},U={key:0},B=o("i",{class:"fa-solid fa-caret-down"},null,-1),N=[B],S={key:1},E=o("i",{class:"fa-solid fa-caret-up"},null,-1),q=[E],G={key:0},Z=o("i",{class:"fa-solid fa-caret-down"},null,-1),z=[Z],H={key:1},J=o("i",{class:"fa-solid fa-caret-up"},null,-1),K=[J],Q={key:0},R=o("i",{class:"fa-solid fa-caret-down"},null,-1),W=[R],X={key:1},Y=o("i",{class:"fa-solid fa-caret-up"},null,-1),x=[Y],oo={key:0},so=o("i",{class:"fa-solid fa-caret-down"},null,-1),to=[so],eo={key:1},no=o("i",{class:"fa-solid fa-caret-up"},null,-1),io=[no],lo=o("th",{scope:"col",class:"text-center"},"Число активация",-1),ro=o("th",{scope:"col",class:"text-center"},"Активный",-1),ao={key:0},co=o("i",{class:"fa-solid fa-caret-down"},null,-1),uo=[co],ho={key:1},mo=o("i",{class:"fa-solid fa-caret-up"},null,-1),_o=[mo],po={key:0},fo=o("i",{class:"fa-solid fa-caret-down"},null,-1),bo=[fo],go={key:1},ko=o("i",{class:"fa-solid fa-caret-up"},null,-1),vo=[ko],$o=o("th",{scope:"col",class:"text-center"},"Действие",-1),yo={scope:"row"},Co=["onClick"],wo={class:"text-center"},Po={class:"text-center"},jo={class:"text-center"},Vo={class:"text-center"},Fo={key:0},Lo={key:1},Ao={class:"text-center"},Io={class:"text-center"},Do={class:"text-center"},Mo={class:"dropdown"},Oo=o("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[o("i",{class:"fa-solid fa-bars"})],-1),To={class:"dropdown-menu"},Uo=["onClick"],Bo=o("i",{class:"fa-solid fa-pen mr-2"},null,-1),No=["onClick"],So=o("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),Eo={key:0,class:"alert alert-success rounded-0",role:"alert"},qo=o("h4",{class:"alert-heading"},"Промокоды",-1),Go=o("p",null,"К сожалению, раздел промокодов пуст. Вы еще не добавили ни одного промокода, которые можно отобразить на этой странице.",-1),Zo=o("hr",null,null,-1),zo=o("p",{class:"mb-0"},"Воспользуйтесь формой выше и добавьте свой первый промокод",-1),Ho=[qo,Go,Zo,zo],Jo={key:1,class:"row mb-3"},Ko={class:"col-12"},Qo={data(){return{sort:{column:null,direction:"desc"},search:null,current_page:0,paginate_object:null,items:[{id:null,title:null,price:0,variants:[]}]}},computed:{...y(["getPromoCodes","getPromoCodesPaginateObject"])},mounted(){this.loadPromoCodes()},methods:{sortAndLoad(d){this.sort.column=d,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadPromoCodes(this.current_page)},loadPromoCodes(d=0){this.current_page=d,this.$store.dispatch("loadPromoCodes",{dataObject:{search:this.search,order:this.sort.column,direction:this.sort.direction},page:this.current_page}).then(s=>{this.items=this.getPromoCodes,this.paginate_object=this.getPromoCodesPaginateObject}).catch(()=>{this.loading=!1})},selectItem(d){this.$emit("select",d)},duplicateItem(d){this.$store.dispatch("duplicatePromoCode",{promoCodeId:d}).then(()=>{this.sortAndLoad("id")})},removeItem(d){this.$store.dispatch("removePromoCode",{promoCodeId:d}).then(()=>{this.sortAndLoad("id")})}}},Ro=Object.assign(Qo,{__name:"PromoCodeTable",setup(d){return(s,e)=>(n(),i(_,null,[o("form",V,[o("div",F,[o("div",L,[o("div",A,[h(o("input",{type:"search","onUpdate:modelValue":e[0]||(e[0]=t=>s.search=t),class:"form-control",id:"search-promo-codes"},null,512),[[m,s.search]]),I]),o("button",{type:"button",onClick:e[1]||(e[1]=t=>s.sortAndLoad("id")),class:"btn btn-outline-secondary rounded-0"},M)])])]),o("div",O,[s.items.length>0?(n(),i("table",T,[o("thead",null,[o("tr",null,[o("th",{scope:"col",class:"cursor-pointer",onClick:e[2]||(e[2]=t=>s.sortAndLoad("id"))},[r("# "),s.sort.direction==="desc"&&s.sort.column==="id"?(n(),i("span",U,N)):l("",!0),s.sort.direction==="asc"&&s.sort.column==="id"?(n(),i("span",S,q)):l("",!0)]),o("th",{scope:"col",class:"text-center cursor-pointer",onClick:e[3]||(e[3]=t=>s.sortAndLoad("code"))},[r("Код "),s.sort.direction==="desc"&&s.sort.column==="code"?(n(),i("span",G,z)):l("",!0),s.sort.direction==="asc"&&s.sort.column==="code"?(n(),i("span",H,K)):l("",!0)]),o("th",{scope:"col",class:"text-center cursor-pointer",onClick:e[4]||(e[4]=t=>s.sortAndLoad("discount"))},[r("Процент скидки "),s.sort.direction==="desc"&&s.sort.column==="discount"?(n(),i("span",Q,W)):l("",!0),s.sort.direction==="asc"&&s.sort.column==="discount"?(n(),i("span",X,x)):l("",!0)]),o("th",{scope:"col",class:"text-center cursor-pointer",onClick:e[5]||(e[5]=t=>s.sortAndLoad("description"))},[r("Описание "),s.sort.direction==="desc"&&s.sort.column==="description"?(n(),i("span",oo,to)):l("",!0),s.sort.direction==="asc"&&s.sort.column==="description"?(n(),i("span",eo,io)):l("",!0)]),lo,ro,o("th",{scope:"col",class:"text-center cursor-pointer",onClick:e[6]||(e[6]=t=>s.sortAndLoad("end_at"))},[r(" Дата окончания "),s.sort.direction==="desc"&&s.sort.column==="end_at"?(n(),i("span",ao,uo)):l("",!0),s.sort.direction==="asc"&&s.sort.column==="end_at"?(n(),i("span",ho,_o)):l("",!0)]),o("th",{scope:"col",class:"text-center cursor-pointer",onClick:e[7]||(e[7]=t=>s.sortAndLoad("updated_at"))},[r(" Дата изменения "),s.sort.direction==="desc"&&s.sort.column==="updated_at"?(n(),i("span",po,bo)):l("",!0),s.sort.direction==="asc"&&s.sort.column==="updated_at"?(n(),i("span",go,vo)):l("",!0)]),$o])]),o("tbody",null,[(n(!0),i(_,null,g(s.items,(t,c)=>(n(),i("tr",null,[o("th",yo,a(t.id||c),1),o("td",{class:"text-center",onClick:u=>s.selectItem(t)},a(t.code||"-"),9,Co),o("td",wo,a(t.discount||0),1),o("td",Po,a(t.description||0),1),o("td",jo,a(t.activation_count||0),1),o("td",Vo,[t.is_active?(n(),i("span",Fo,"Активный")):(n(),i("span",Lo,"Не активный"))]),o("td",Ao,a(t.end_at||"-"),1),o("td",Io,a(t.updated_at||"-"),1),o("td",Do,[o("div",Mo,[Oo,o("ul",To,[o("li",null,[o("a",{class:"dropdown-item",onClick:u=>s.selectItem(t),href:"javascript:void(0)"},[Bo,r("Редактировать")],8,Uo)]),o("li",null,[o("a",{class:"dropdown-item text-danger",onClick:u=>s.removeItem(t.id),href:"javascript:void(0)"},[So,r("Удалить")],8,No)])])])])]))),256))])])):l("",!0)]),s.items.length===0?(n(),i("div",Eo,Ho)):l("",!0),s.items.length>0?(n(),i("div",Jo,[o("div",Ko,[s.paginate_object?(n(),p(j,{key:0,onPagination_page:s.loadPromoCodes,pagination:s.paginate_object},null,8,["onPagination_page","pagination"])):l("",!0)])])):l("",!0)],64))}}),Wo={class:"form-floating mb-3"},Xo=o("label",{for:"promo-code-code"},"Промокод",-1),Yo={class:"form-floating mb-3"},xo=o("label",{for:"promo-code-discount"},"Процент скидки",-1),os={class:"form-floating mb-3"},ss=o("label",{for:"promo-code-comment"},"Комментарий к промокоду",-1),ts={class:"form-check form-switch"},es=o("label",{class:"form-check-label",for:"promo-code-is-active"}," Доступен для активации ",-1),ns={class:"row"},is={class:"col-12"},ds=o("label",{class:"form-check-label",for:"promo-code-is-active"}," Дата завершения ",-1),ls={class:"action-row"},rs=["onClick"],as=["onClick"],cs={class:"row"},us={class:"col-12"},hs={class:"alert alert-danger alert-dismissible fade show",role:"alert"},ms=o("strong",null,"Внимание!",-1),_s=["onClick"],ps={class:"row mt-5"},fs={class:"col-12 d-flex justify-content-center"},bs=["disabled"],gs={key:0,class:"fa-regular fa-floppy-disk mr-1"},ks={key:1,class:"spinner-border spinner-border-sm text-success",role:"status"},vs=o("i",{class:"fa-solid fa-xmark mr-1"},null,-1),$s={props:["item"],components:{VueDatePicker:v},data(){return{messages:[],loading:!1,form:{id:null,code:null,description:null,discount:0,end_at:null,is_active:!0}}},computed:{needClearForm(){return this.form.id||this.form.code||this.form.description||this.form.discount||this.form.end_at}},mounted(){this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,code:this.item.code||null,description:this.item.description||null,discount:this.item.discount||0,end_at:this.item.end_at||null,is_active:this.item.is_active||!0}})},methods:{alert(d){this.messages.push(d)},resetForm(){this.form.id=null,this.form.code=null,this.form.discount=0,this.form.description=null,this.form.end_at=null,this.form.is_active=!1,this.$emit("callback")},removeMessage(d){this.messages.splice(d,1)},submit(){this.$store.dispatch("storePromoCode",{promoCodeForm:this.form}).then(d=>{this.$notify({title:"DoDoors",text:"Промокод успешно добавлен",type:"success"}),this.$emit("callback"),this.resetForm()}).catch(d=>{this.$notify({title:"DoDoors",text:"Ошибка добавления промокода",type:"error"})})}}},ys=Object.assign($s,{__name:"PomoCodeForm",setup(d){return(s,e)=>(n(),i("form",{action:"",onSubmit:e[6]||(e[6]=w((...t)=>s.submit&&s.submit(...t),["prevent"]))},[o("div",Wo,[h(o("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>s.form.code=t),maxlength:"5",class:"form-control",id:"promo-code-code",required:""},null,512),[[m,s.form.code]]),Xo]),o("div",Yo,[h(o("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=t=>s.form.discount=t),step:"0.01",min:"0",max:"100",class:"form-control",id:"promo-code-discount",required:""},null,512),[[m,s.form.discount]]),xo]),o("div",os,[h(o("textarea",{class:"form-control border-secondary rounded-0","onUpdate:modelValue":e[2]||(e[2]=t=>s.form.description=t),style:{"min-height":"100px"},placeholder:"Оставьте комментарий",id:"promo-code-comment"},`
            `,512),[[m,s.form.description]]),ss]),o("div",ts,[h(o("input",{class:"form-check-input","onUpdate:modelValue":e[3]||(e[3]=t=>s.form.is_active=t),type:"checkbox",role:"switch",id:"promo-code-is-active",checked:""},null,512),[[C,s.form.is_active]]),es]),o("div",ns,[o("div",is,[ds,f(k(v),{locale:"ru",modelValue:s.form.end_at,"onUpdate:modelValue":e[4]||(e[4]=t=>s.form.end_at=t)},{"action-row":b(({internalModelValue:t,selectDate:c,closePicker:u})=>[o("div",ls,[o("button",{type:"button",class:"btn btn-dark rounded-0 mr-2",onClick:c},"Выбрать",8,rs),o("button",{type:"button",class:"btn btn-outline-secondary rounded-0",onClick:u},"Закрыть",8,as)])]),_:1},8,["modelValue"])])]),o("div",cs,[o("div",us,[s.messages.length>0?(n(!0),i(_,{key:0},g(s.messages,(t,c)=>(n(),i("div",hs,[ms,r(" "+a(t||"Ошибка")+" ",1),o("button",{type:"button",class:"btn-close",onClick:u=>s.removeMessage(c)},null,8,_s)]))),256)):l("",!0)])]),o("div",ps,[o("div",fs,[o("button",{disabled:!s.needClearForm,class:"btn btn-dark rounded-0"},[s.loading?(n(),i("span",ks)):(n(),i("i",gs)),r(" Сохранить промокод ")],8,bs),s.needClearForm&&!s.loading?(n(),i("button",{key:0,type:"button",onClick:e[5]||(e[5]=(...t)=>s.resetForm&&s.resetForm(...t)),class:"btn btn-outline-secondary rounded-0 ml-2"},[vs,r(" Очистить форму ")])):l("",!0)])])],32))}}),Cs=o("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Промокоды",-1),ws={class:"py-12"},Ps={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},js={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Vs={class:"p-6 text-gray-900"},Fs=o("hr",{class:"hr my-5"},null,-1),Ls={data(){return{loading:!1,selectedPromoCode:null}},methods:{selectPromoCode(d){this.selectedPromoCode=d,this.loading=!0,this.$nextTick(()=>{this.loading=!1})},callbackPromoCodeForm(){this.loading=!0,this.selectedPromoCode=null,this.$nextTick(()=>{this.loading=!1})}}},Us=Object.assign(Ls,{__name:"PromoCodesPage",setup(d){return(s,e)=>(n(),i(_,null,[f(k(P),{title:"Промокоды"}),f($,null,{header:b(()=>[Cs]),default:b(()=>[o("div",ws,[o("div",Ps,[o("div",js,[o("div",Vs,[s.loading?l("",!0):(n(),p(ys,{key:0,item:s.selectedPromoCode,onCallback:s.callbackPromoCodeForm},null,8,["item","onCallback"])),Fs,s.loading?l("",!0):(n(),p(Ro,{key:1,onSelect:s.selectPromoCode},null,8,["onSelect"]))])])])])]),_:1})],64))}});export{Us as default};
