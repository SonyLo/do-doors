import{o as r,c as l,b as e,f as a,h as c,j as _,g as p,t as h,e as f,v as u,F as b}from"./app-Bl0GmcH9.js";import{_ as w}from"./_plugin-vue_export-helper-DlAUqK2U.js";const g={data(){return{timer:null,affected:null,generateForm:{base_width:0,base_height:0,base_koef:0,base_loops:0,base_price:0,width_step:0,height_step:0,koef_step:0,loops_step:0,price_step:0,selected_material:null,steps:0},need_import_from_google:!1,importGoogleForm:{sheet_id:null,use_price_koef:!0,need_rewrite:!0},importForm:{need_rewrite:!0,use_price_koef:!0,files:[]},recountForm:{selected_material:null,need_recount_by_width:!1,need_recount_by_height:!1,base_width:null,base_height:null,recount_price:null},confirmModal:null,importPricesModal:null}},mounted(){this.confirmModal=new bootstrap.Modal(document.getElementById("confirm-modal"),{}),this.importPricesModal=new bootstrap.Modal(document.getElementById("import-prices-form"),{}),this.importGoogleForm.sheet_id=localStorage.getItem("google_excel_export_sheet_id")||null},methods:{openConfirmModal(){this.confirmModal.show()},onChangeFile(n){const o=n.target.files;for(let i=0;i<o.length;i++)this.importForm.files.push(o[i])},saveFormattedSizes(){this.$store.dispatch("updatedFormattedSizes").then(n=>{this.confirmModal.hide(),window.dispatchEvent(new CustomEvent("load-sizes",{detail:null})),this.$notify({title:"DoDoors",text:"Вы успешно обновили данные"}),window.location.reload()}).catch(()=>{this.$notify({title:"DoDoors",text:"Ошибка обновления данных",type:"error"}),window.location.reload()})},openImportFormModal(){this.importPricesModal.show()},importFromGoogleSubmit(){let n=new FormData;localStorage.setItem("google_excel_export_sheet_id",this.importGoogleForm.sheet_id),this.timer=0;let o=setInterval(()=>{this.timer++},1e3);Object.keys(this.importGoogleForm).forEach(i=>{const m=this.importGoogleForm[i]||"";typeof m=="object"?n.append(i,JSON.stringify(m)):n.append(i,m)}),this.$store.dispatch("importSizesFromGoogle",{importForm:n}).then(i=>{window.open(i.url,"_blank").focus(),window.dispatchEvent(new CustomEvent("load-sizes",{detail:null})),this.importPricesModal.hide(),this.$notify({title:"DoDoors",text:"Вы успешно загрузили данные"}),clearInterval(o),this.timer=null,this.confirmModal.show()}).catch(()=>{clearInterval(o),this.timer=null,this.$notify({title:"DoDoors",text:"Ошибка загрузки данных",type:"error"})})},importSubmit(){let n=new FormData;this.timer=0;let o=setInterval(()=>{this.timer++},1e3);if(Object.keys(this.importForm).forEach(i=>{const m=this.importForm[i]||"";typeof m=="object"?n.append(i,JSON.stringify(m)):n.append(i,m)}),this.importForm.files.length>0){n.delete("files");for(let i=0;i<this.importForm.files.length;i++)n.append("files[]",this.importForm.files[i])}this.$store.dispatch("importSizes",{importForm:n}).then(i=>{window.dispatchEvent(new CustomEvent("load-sizes",{detail:null})),this.importPricesModal.hide(),this.$notify({title:"DoDoors",text:"Вы успешно загрузили данные"}),clearInterval(o),this.timer=null,this.confirmModal.show()}).catch(()=>{clearInterval(o),this.timer=null,this.$notify({title:"DoDoors",text:"Ошибка загрузки данных",type:"error"})})}}},y={class:"row"},k={class:"col-12 d-flex"},v={class:"dropdown mb-2"},F=e("button",{class:"btn btn-outline-secondary dropdown-toggle w-100 rounded-0 p-3",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-bars mr-2"}),p("Управление разделом ")],-1),x={class:"dropdown-menu rounded-0"},M=e("li",null,[e("a",{class:"dropdown-item",href:"/sizes/export-prices"},"Скачать шаблон таблицы")],-1),S={class:"modal fade",id:"import-prices-form",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},G={class:"modal-dialog"},C={class:"modal-content rounded-0"},D=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"exampleModalLabel"},"Форма загрузки таблицы"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),E={class:"modal-body"},I={class:"form-check form-switch"},z={class:"form-check-label",for:"need_rewrite"},V={key:0},j={key:1},N={class:"form-check form-switch"},O={class:"form-check-label",for:"need_rewrite"},P={key:0},U={key:1},B={class:"form-check form-switch"},J={class:"form-check-label",for:"need_rewrite"},T={key:0},L={key:1},q={class:"form-floating my-3 border-gray-100 border"},A=e("label",{for:"excel-file-for-import"},"Файл-эксель",-1),H=["disabled"],K={key:0},Q={class:"form-check form-switch"},R={class:"form-check-label",for:"need_rewrite_google"},W={key:0},X={key:1},Y={class:"form-check form-switch"},Z={class:"form-check-label",for:"need_rewrite"},$={key:0},ee={key:1},oe={class:"form-floating my-3 border-gray-100 border"},te=e("label",{for:"sheet-id"},"Идентификатор таблицы",-1),se=["disabled"],ie={key:0},re=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary rounded-0","data-bs-dismiss":"modal"},"Закрыть")],-1),le={class:"modal fade",id:"confirm-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ne={class:"modal-dialog"},de={class:"modal-content rounded-0"},me={class:"modal-body"},ae=e("p",null,"Вы хотите обновить JSON-файл с размерами?",-1),ce={class:"row"},pe={class:"col-6"},_e={class:"col-6"};function he(n,o,i,m,t,d){return r(),l(b,null,[e("div",y,[e("div",k,[e("div",v,[F,e("ul",x,[M,e("li",null,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:o[0]||(o[0]=(...s)=>d.openImportFormModal&&d.openImportFormModal(...s))},"Загрузить данные")]),e("li",null,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:o[1]||(o[1]=(...s)=>d.openConfirmModal&&d.openConfirmModal(...s))},"Обновить JSON")])])])])]),e("div",S,[e("div",G,[e("div",C,[D,e("div",E,[e("div",I,[a(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=s=>t.need_import_from_google=s),type:"checkbox",role:"switch",id:"need_rewrite"},null,512),[[c,t.need_import_from_google]]),e("label",z,[t.need_import_from_google?(r(),l("span",V,"Загрузить из Google-таблицы")):(r(),l("span",j,"Загрузить из Excel-файла"))])]),t.need_import_from_google?(r(),l("form",{key:1,onSubmit:o[10]||(o[10]=_((...s)=>d.importFromGoogleSubmit&&d.importFromGoogleSubmit(...s),["prevent"]))},[e("div",Q,[a(e("input",{class:"form-check-input","onUpdate:modelValue":o[7]||(o[7]=s=>t.importGoogleForm.need_rewrite=s),type:"checkbox",role:"switch",id:"need_rewrite_google"},null,512),[[c,t.importGoogleForm.need_rewrite]]),e("label",R,[t.importGoogleForm.need_rewrite?(r(),l("span",W,"Перезаписать старые значения")):(r(),l("span",X,"Добавить новые значения"))])]),e("div",Y,[a(e("input",{class:"form-check-input","onUpdate:modelValue":o[8]||(o[8]=s=>t.importGoogleForm.use_price_koef=s),type:"checkbox",role:"switch",id:"need_rewrite"},null,512),[[c,t.importGoogleForm.use_price_koef]]),e("label",Z,[t.importGoogleForm.use_price_koef?(r(),l("span",$,"Использовать ценовые коэффициенты для расчета")):(r(),l("span",ee,"Записать как есть"))])]),e("div",oe,[a(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[9]||(o[9]=s=>t.importGoogleForm.sheet_id=s),id:"sheet-id",placeholder:"name@example.com"},null,512),[[u,t.importGoogleForm.sheet_id]]),te]),e("button",{type:"submit",disabled:t.timer!=null,class:"btn btn-dark rounded-0 w-100 p-3"},[p("Загрузить "),t.timer!=null?(r(),l("span",ie,h(t.timer)+" сек",1)):f("",!0)],8,se)],32)):(r(),l("form",{key:0,onSubmit:o[6]||(o[6]=_((...s)=>d.importSubmit&&d.importSubmit(...s),["prevent"]))},[e("div",N,[a(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=s=>t.importForm.need_rewrite=s),type:"checkbox",role:"switch",id:"need_rewrite"},null,512),[[c,t.importForm.need_rewrite]]),e("label",O,[t.importForm.need_rewrite?(r(),l("span",P,"Перезаписать старые значения")):(r(),l("span",U,"Добавить новые значения"))])]),e("div",B,[a(e("input",{class:"form-check-input","onUpdate:modelValue":o[4]||(o[4]=s=>t.importForm.use_price_koef=s),type:"checkbox",role:"switch",id:"need_rewrite"},null,512),[[c,t.importForm.use_price_koef]]),e("label",J,[t.importForm.use_price_koef?(r(),l("span",T,"Использовать ценовые коэффициенты для расчета")):(r(),l("span",L,"Записать как есть"))])]),e("div",q,[e("input",{type:"file",class:"form-control",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",id:"excel-file-for-import",ref:"importPriceFromExcel",onChange:o[5]||(o[5]=s=>d.onChangeFile(s))},null,544),A]),e("button",{type:"submit",disabled:t.timer!=null,class:"btn btn-dark rounded-0 w-100 p-3"},[p("Загрузить "),t.timer!=null?(r(),l("span",K,h(t.timer)+" сек",1)):f("",!0)],8,H)],32))]),re])])]),e("div",le,[e("div",ne,[e("div",de,[e("div",me,[ae,e("div",ce,[e("div",pe,[e("button",{class:"btn btn-dark rounded-0 w-100",type:"button",onClick:o[11]||(o[11]=(...s)=>d.saveFormattedSizes&&d.saveFormattedSizes(...s))},"Да, продолжить ")]),e("div",_e,[e("button",{class:"btn btn-outline-secondary rounded-0 w-100",onClick:o[12]||(o[12]=s=>t.confirmModal.hide())},"Нет, отменить ")])])])])])])],64)}const be=w(g,[["render",he]]);export{be as S};
