import{_ as k}from"./AuthenticatedLayout-BwlFaWt8.js";import"./CalcForm-DRuIm5MQ.js";import{_ as x}from"./MaterialTable-DwlZb0yB.js";import{o as a,c as r,b as e,f as c,v as m,h as v,e as p,F as h,r as u,g as f,j as U,t as C,a as b,u as V,w as y,Z as M,d as w}from"./app-CxYZ2Lw4.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-CPHbI4qR.js";import"./vue-the-mask-8BRBEpNH.js";import"./RalColorSelector-DPOAZ28v.js";import"./Pagination-BLsYNeO3.js";const F={props:["item"],data(){return{messages:[],uploaded_wrapper_image:[],uploaded_door_image:[],loading:!1,form:{id:null,title:null,is_base:!1,order_position:0,need_generate_sizes:!1,wrapper_variants:[],door_variants:[]}}},computed:{needClearForm(){return this.form.id||this.form.title||this.uploaded_wrapper_image.length>0||this.uploaded_door_image.length>0}},mounted(){this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,title:this.item.title||null,is_base:this.item.is_base||!1,order_position:this.item.order_position||0,wrapper_variants:this.item.wrapper_variants||[],door_variants:this.item.door_variants||[]}})},methods:{alert(l){this.messages.push(l)},resetForm(){this.uploaded_wrapper_image=[],this.uploaded_door_image=[],this.form.id=null,this.form.title=null,this.form.order_position=0,this.form.is_base=!1,this.form.wrapper_variants=[],this.form.door_variants=[],this.$refs.doorImageRef.value=null,this.$refs.wrapperImageRef.value=null,this.$emit("callback")},removeUploadedPhoto(l,o){this.form[l].splice(o,1)},removePhoto(l,o){this[l].splice(o,1)},getPhoto(l){return{imageUrl:URL.createObjectURL(l)}},onChangePhotos(l,o){const _=o.target.files;for(let g=0;g<_.length;g++)this[l].push({image:_[g],title:null,description:null})},removeMessage(l){this.messages.splice(l,1)},submit(){let l=new FormData;if(Object.keys(this.form).forEach(o=>{const _=this.form[o]||"";typeof _=="object"?l.append(o,JSON.stringify(_)):l.append(o,_)}),this.uploaded_wrapper_image.length>0){for(let o=0;o<this.uploaded_wrapper_image.length;o++)l.append("wrapper_images[]",this.uploaded_wrapper_image[o].image),this.uploaded_wrapper_image[o].image_name=this.uploaded_wrapper_image[o].image.name||null;l.append("wrapper_images_info",JSON.stringify(this.uploaded_wrapper_image))}if(this.uploaded_door_image.length>0){for(let o=0;o<this.uploaded_door_image.length;o++)l.append("door_images[]",this.uploaded_door_image[o].image),this.uploaded_door_image[o].image_name=this.uploaded_door_image[o].image.name||null;l.append("door_images_info",JSON.stringify(this.uploaded_door_image))}this.$store.dispatch("storeMaterial",{materialForm:l}).then(o=>{this.resetForm(),this.$emit("callback")}).catch(o=>{this.alert(o.response.data.message)})}}},P={class:"row"},T={class:"col-md-6 col-12"},I={class:"form-floating mb-3"},q=e("label",{for:"material-title"},"Название материала",-1),O={class:"col-md-6 col-12"},L={class:"form-floating mb-3"},N=e("label",{for:"material-order-position"},"Позиция материала в выдаче",-1),S={class:"form-check form-switch mb-3"},R=e("label",{class:"form-check-label",for:"is-base"}," Является базой ",-1),B={class:"form-check form-switch mb-3"},z=e("label",{class:"form-check-label",for:"recount-by-width"}," Автоматически создать заглушки размеров ",-1),D={class:"form-floating mb-3 border-gray-100 border"},J=e("label",{for:"door-material"},"Текстура материала для двери",-1),E={class:"row"},Z={key:0,class:"col-12"},A=e("h6",{class:"font-bold my-3"},"Новые фотографии к материалу",-1),G=[A],H={class:"col-md-4 mb-2 image-preview d-flex align-items-start"},K={class:"card w-100"},Q=["src"],W={class:"card-body d-flex justify-center"},X=["onClick"],Y={class:"card-body"},$={class:"form-floating mb-3"},ee=["onUpdate:modelValue"],oe=e("label",{for:"floatingInput"},"Название",-1),te={class:"form-floating"},se=["onUpdate:modelValue"],ie=e("label",{for:"floatingTextarea"},"Описание",-1),ae={key:1,class:"col-12"},le=e("h6",{class:"font-bold my-3"},"Текущие фотографии к материалу",-1),re=[le],de={class:"col-md-4 mb-2 image-preview d-flex align-items-start"},ne={class:"card w-100"},ce=["src"],me=["src"],_e={class:"card-body d-flex justify-center"},pe=["onClick"],he={class:"card-body"},ue={class:"form-floating mb-3"},ge=["onUpdate:modelValue"],fe=e("label",{for:"floatingInput"},"Название",-1),ve={class:"form-floating"},be=["onUpdate:modelValue"],ye=e("label",{for:"floatingTextarea"},"Описание",-1),we={class:"form-floating mb-3 border-gray-100 border"},ke=e("label",{for:"material-wrapper"},"Текстура материала вокруг двери",-1),xe={class:"row"},Ue={key:0,class:"col-12"},Ce=e("h6",{class:"font-bold my-3"},"Новые фотографии к материалу",-1),Ve=[Ce],Me={class:"col-md-4 mb-2 image-preview d-flex align-items-start"},je={class:"card w-100"},Fe=["src"],Pe={class:"card-body d-flex justify-center"},Te=["onClick"],Ie={class:"card-body"},qe={class:"form-floating mb-3"},Oe=["onUpdate:modelValue"],Le=e("label",{for:"floatingInput"},"Название",-1),Ne={class:"form-floating"},Se=["onUpdate:modelValue"],Re=e("label",{for:"floatingTextarea"},"Описание",-1),Be={key:1,class:"col-12"},ze=e("h6",{class:"font-bold my-3"},"Текущие фотографии к материалу",-1),De=[ze],Je={class:"col-md-4 mb-2 image-preview d-flex align-items-start"},Ee={class:"card w-100"},Ze=["src"],Ae=["src"],Ge={class:"card-body d-flex justify-center"},He=["onClick"],Ke={class:"card-body"},Qe={class:"form-floating mb-3"},We=["onUpdate:modelValue"],Xe=e("label",{for:"floatingInput"},"Название",-1),Ye={class:"form-floating"},$e=["onUpdate:modelValue"],eo=e("label",{for:"floatingTextarea"},"Описание",-1),oo={class:"row"},to={class:"col-12"},so={class:"alert alert-danger alert-dismissible fade show",role:"alert"},io=e("strong",null,"Внимание!",-1),ao=["onClick"],lo={class:"row mt-5"},ro={class:"col-12 d-flex justify-content-center"},no=["disabled"],co={key:0,class:"fa-regular fa-floppy-disk mr-1"},mo={key:1,class:"spinner-border spinner-border-sm text-success",role:"status"},_o=e("i",{class:"fa-solid fa-xmark mr-1"},null,-1);function po(l,o,_,g,t,n){return a(),r("form",{action:"",onSubmit:o[7]||(o[7]=U((...s)=>n.submit&&n.submit(...s),["prevent"]))},[e("div",P,[e("div",T,[e("div",I,[c(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>t.form.title=s),class:"form-control",id:"material-title",placeholder:"name@example.com",required:""},null,512),[[m,t.form.title]]),q])]),e("div",O,[e("div",L,[c(e("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=s=>t.form.order_position=s),class:"form-control",id:"material-order-position",placeholder:"name@example.com",required:""},null,512),[[m,t.form.order_position]]),N])])]),e("div",S,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=s=>t.form.is_base=s),type:"checkbox",role:"switch",id:"is-base"},null,512),[[v,t.form.is_base]]),R]),e("div",B,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[3]||(o[3]=s=>t.form.need_generate_sizes=s),type:"checkbox",role:"switch",id:"recount-by-width"},null,512),[[v,t.form.need_generate_sizes]]),z]),e("div",D,[e("input",{type:"file",class:"form-control",accept:"image/*",id:"door-material",ref:"doorImageRef",onChange:o[4]||(o[4]=s=>n.onChangePhotos("uploaded_door_image",s)),placeholder:"name@example.com",multiple:""},null,544),J]),e("div",E,[t.uploaded_door_image.length>0?(a(),r("div",Z,G)):p("",!0),(a(!0),r(h,null,u(t.uploaded_door_image,(s,i)=>(a(),r("div",H,[e("div",K,[e("img",{style:{"min-height":"200px"},src:n.getPhoto(s.image).imageUrl,class:"card-img-top uploaded-image-mini",alt:""},null,8,Q),e("div",W,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:d=>n.removePhoto("uploaded_door_image",i)},"Удалить фото",8,X)]),e("div",Y,[e("div",$,[c(e("input",{type:"text","onUpdate:modelValue":d=>t.uploaded_door_image[i].title=d,class:"form-control border-gray-300 rounded-md",id:"floatingInput",required:""},null,8,ee),[[m,t.uploaded_door_image[i].title]]),oe]),e("div",te,[c(e("textarea",{class:"form-control","onUpdate:modelValue":d=>t.uploaded_door_image[i].description=d,placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,8,se),[[m,t.uploaded_door_image[i].description]]),ie])])])]))),256)),t.form.door_variants.length>0?(a(),r("div",ae,re)):p("",!0),(a(!0),r(h,null,u(t.form.door_variants,(s,i)=>(a(),r("div",de,[e("div",ne,[s.image.indexOf("http")===-1?(a(),r("img",{key:0,style:{"min-height":"200px"},src:"/images/"+s.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,ce)):(a(),r("img",{key:1,style:{"min-height":"200px"},src:s.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,me)),e("div",_e,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:d=>n.removeUploadedPhoto("door_variants",i)},"Удалить",8,pe)]),e("div",he,[e("div",ue,[c(e("input",{type:"text","onUpdate:modelValue":d=>t.form.door_variants[i].title=d,class:"form-control border-gray-300 rounded-md",id:"floatingInput",required:""},null,8,ge),[[m,t.form.door_variants[i].title]]),fe]),e("div",ve,[c(e("textarea",{class:"form-control","onUpdate:modelValue":d=>t.form.door_variants[i].description=d,placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,8,be),[[m,t.form.door_variants[i].description]]),ye])])])]))),256))]),e("div",we,[e("input",{type:"file",class:"form-control",id:"material-wrapper",accept:"image/*",ref:"wrapperImageRef",onChange:o[5]||(o[5]=s=>n.onChangePhotos("uploaded_wrapper_image",s)),placeholder:"name@example.com",multiple:""},null,544),ke]),e("div",xe,[t.uploaded_wrapper_image.length>0?(a(),r("div",Ue,Ve)):p("",!0),(a(!0),r(h,null,u(t.uploaded_wrapper_image,(s,i)=>(a(),r("div",Me,[e("div",je,[e("img",{style:{"min-height":"200px"},src:n.getPhoto(s.image).imageUrl,class:"card-img-top uploaded-image-mini",alt:""},null,8,Fe),e("div",Pe,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:d=>n.removePhoto("uploaded_wrapper_image",i)},"Удалить фото",8,Te)]),e("div",Ie,[e("div",qe,[c(e("input",{type:"text","onUpdate:modelValue":d=>t.uploaded_wrapper_image[i].title=d,class:"form-control border-gray-300 rounded-md",id:"floatingInput"},null,8,Oe),[[m,t.uploaded_wrapper_image[i].title]]),Le]),e("div",Ne,[c(e("textarea",{class:"form-control","onUpdate:modelValue":d=>t.uploaded_wrapper_image[i].description=d,placeholder:"Leave a comment here",id:"floatingTextarea"},null,8,Se),[[m,t.uploaded_wrapper_image[i].description]]),Re])])])]))),256)),t.form.wrapper_variants.length>0?(a(),r("div",Be,De)):p("",!0),(a(!0),r(h,null,u(t.form.wrapper_variants,(s,i)=>(a(),r("div",Je,[e("div",Ee,[s.image.indexOf("http")===-1?(a(),r("img",{key:0,style:{"min-height":"200px"},src:"/images/"+s.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,Ze)):(a(),r("img",{key:1,style:{"min-height":"200px"},src:s.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,Ae)),e("div",Ge,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:d=>n.removeUploadedPhoto("wrapper_variants",i)},"Удалить",8,He)]),e("div",Ke,[e("div",Qe,[c(e("input",{type:"text","onUpdate:modelValue":d=>t.form.wrapper_variants[i].title=d,class:"form-control border-gray-300 rounded-md",id:"floatingInput",required:""},null,8,We),[[m,t.form.wrapper_variants[i].title]]),Xe]),e("div",Ye,[c(e("textarea",{class:"form-control","onUpdate:modelValue":d=>t.form.wrapper_variants[i].description=d,placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,8,$e),[[m,t.form.wrapper_variants[i].description]]),eo])])])]))),256))]),e("div",oo,[e("div",to,[t.messages.length>0?(a(!0),r(h,{key:0},u(t.messages,(s,i)=>(a(),r("div",so,[io,f(" "+C(s||"Ошибка")+" ",1),e("button",{type:"button",class:"btn-close",onClick:d=>n.removeMessage(i)},null,8,ao)]))),256)):p("",!0)])]),e("div",lo,[e("div",ro,[e("button",{disabled:!n.needClearForm,class:"btn btn-dark rounded-0"},[t.loading?(a(),r("span",mo)):(a(),r("i",co)),f(" Сохранить материал ")],8,no),n.needClearForm&&!t.loading?(a(),r("button",{key:0,type:"button",onClick:o[6]||(o[6]=(...s)=>n.resetForm&&n.resetForm(...s)),class:"btn btn-outline-danger rounded-0 ml-2"},[_o,f(" Очистить форму ")])):p("",!0)])])],32)}const ho=j(F,[["render",po]]),uo=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Материалы",-1),go={class:"py-12"},fo={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},vo={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},bo={class:"p-6 text-gray-900"},yo=e("hr",{class:"hr my-5"},null,-1),wo={data(){return{loading:!1,selectedMaterial:null}},methods:{selectMaterial(l){this.selectedMaterial=l,this.loading=!0,this.$nextTick(()=>{this.loading=!1})},callbackMaterialForm(){this.loading=!0,this.selectedMaterial=null,this.$nextTick(()=>{this.loading=!1})}}},To=Object.assign(wo,{__name:"MaterialsPage",setup(l){return(o,_)=>(a(),r(h,null,[b(V(M),{title:"Материалы"}),b(k,null,{header:y(()=>[uo]),default:y(()=>[e("div",go,[e("div",fo,[e("div",vo,[e("div",bo,[o.loading?p("",!0):(a(),w(ho,{key:0,item:o.selectedMaterial,onCallback:o.callbackMaterialForm},null,8,["item","onCallback"])),yo,o.loading?p("",!0):(a(),w(x,{key:1,onSelect:o.selectMaterial},null,8,["onSelect"]))])])])])]),_:1})],64))}});export{To as default};
