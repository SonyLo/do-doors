import{_ as w}from"./AuthenticatedLayout-D8GMU6PC.js";import{o,c as i,b as e,f as h,v as m,g as $,h as S,F as p,r as v,i as a,e as d,j as C,t as u,m as V,d as f,l as j,a as b,u as F,w as g,Z as I}from"./app-Drtuuy74.js";import{P as U}from"./Pagination-BBBrmVXi.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-BQr73xaN.js";import"./vue-the-mask-n-nJnpuw.js";const L={props:["item"],data(){return{messages:[],loading:!1,types:[{title:"Работа с ручками",value:"service_handle"},{title:"Работа со стопором",value:"service_stopper"},{title:"Работа с порогом",value:"service_doorstep"},{title:"Работа с доводчиком",value:"service_door_closer"},{title:"Работа с плинтусом",value:"service_baseboard"},{title:"Установка двери",value:"service_door_install"},{title:"Упаковка двери",value:"service_door_wrapper"},{title:"Покраска элементов",value:"service_painting"}],form:{id:null,title:null,description:null,type:null,order_position:0,is_active:!0,price:{wholesale:0,dealer:0,retail:0,cost:0}}}},computed:{needClearForm(){return this.form.id||this.form.title||this.form.description||this.form.order_position||this.form.type}},mounted(){this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,title:this.item.title||null,description:this.item.description||null,is_active:this.item.is_active||!0,type:this.item.type||null,order_position:this.item.order_position||0,price:this.item.price||{wholesale:0,dealer:0,retail:0,cost:0}}})},methods:{alert(r){this.messages.push(r)},resetForm(){this.form.id=null,this.form.title=null,this.form.description=null,this.form.type=null,this.form.order_position=0,this.form.is_active=!1,this.form.price={wholesale:0,dealer:0,retail:0,cost:0},this.$emit("callback")},removeMessage(r){this.messages.splice(r,1)},submit(){let r=new FormData;Object.keys(this.form).forEach(t=>{const n=this.form[t]||"";typeof n=="object"?r.append(t,JSON.stringify(n)):r.append(t,n)}),this.$store.dispatch("storeService",{serviceForm:r}).then(t=>{this.$emit("callback"),this.resetForm()}).catch(t=>{})}}},M={class:"form-floating mb-3"},A=e("label",{for:"service-title"},"Наименование варианта двери",-1),O={class:"form-floating mb-3"},P=e("label",{for:"service-description"},"Пояснение к параметру",-1),T={class:"form-check form-switch mb-3"},N=e("label",{class:"form-check-label",for:"service-is_active"}," Отображается в калькуляторе ",-1),q={class:"form-floating mb-3"},B=["value"],D=e("label",{for:"service-type"},"Тип сервиса",-1),E={class:"form-floating mb-3"},G=e("label",{for:"service-order_position"},"Позиция в выдаче",-1),J={class:"card rounded-0 mb-3 border-black"},Z=e("div",{class:"card-header bg-dark text-white rounded-0"},[e("h6",null,"Настройка цены")],-1),z={class:"card-body"},H={class:"row"},K={class:"col-md-6 col-12"},Q={class:"form-floating mb-3"},R={for:"price-wholesale"},W={key:0},X={key:1},Y={class:"col-md-6 col-12"},ee={class:"form-floating mb-3"},te={for:"price-retail"},se={key:0},oe={key:1},ie={class:"col-md-6 col-12 mb-3"},le={class:"form-floating"},re={for:"price-dealer"},ne={key:0},de={key:1},ce={class:"col-md-6 col-12"},ae={class:"form-floating"},_e={for:"price-cost"},he={key:0},me={key:1},ue={class:"row"},pe={class:"col-12"},fe={class:"alert alert-danger alert-dismissible fade show",role:"alert"},ve=e("strong",null,"Внимание!",-1),be=["onClick"],ge={class:"row mt-5"},ye={class:"col-12 d-flex justify-content-center"},ke=["disabled"],we={key:0,class:"fa-regular fa-floppy-disk mr-1"},$e={key:1,class:"spinner-border spinner-border-sm text-success",role:"status"},Se=e("i",{class:"fa-solid fa-xmark mr-1"},null,-1);function Ce(r,t,n,c,s,_){return o(),i("form",{action:"",onSubmit:t[10]||(t[10]=C((...l)=>_.submit&&_.submit(...l),["prevent"]))},[e("div",M,[h(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>s.form.title=l),class:"form-control",id:"service-title",required:""},null,512),[[m,s.form.title]]),A]),e("div",O,[h(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=l=>s.form.description=l),class:"form-control",id:"service-description"},null,512),[[m,s.form.description]]),P]),e("div",T,[h(e("input",{class:"form-check-input","onUpdate:modelValue":t[2]||(t[2]=l=>s.form.is_active=l),type:"checkbox",role:"switch",id:"service-is_active"},null,512),[[$,s.form.is_active]]),N]),e("div",q,[h(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=l=>s.form.type=l),id:"service-type","aria-label":"Floating label select example"},[(o(!0),i(p,null,v(s.types,l=>(o(),i("option",{value:l.value},u(l.title||"-"),9,B))),256))],512),[[S,s.form.type]]),D]),e("div",E,[h(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=l=>s.form.order_position=l),class:"form-control",id:"service-order_position"},null,512),[[m,s.form.order_position]]),G]),e("div",J,[Z,e("div",z,[e("div",H,[e("div",K,[e("div",Q,[h(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=l=>s.form.price.wholesale=l),class:"form-control",id:"price-wholesale",required:""},null,512),[[m,s.form.price.wholesale]]),e("label",R,[a("Опт"),s.form.need_percent_price?(o(),i("span",W,", %")):(o(),i("span",X,", руб"))])])]),e("div",Y,[e("div",ee,[h(e("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=l=>s.form.price.retail=l),class:"form-control",id:"price-retail",required:""},null,512),[[m,s.form.price.retail]]),e("label",te,[a("Розница"),s.form.need_percent_price?(o(),i("span",se,", %")):(o(),i("span",oe,", руб"))])])]),e("div",ie,[e("div",le,[h(e("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=l=>s.form.price.dealer=l),class:"form-control",id:"price-dealer",required:""},null,512),[[m,s.form.price.dealer]]),e("label",re,[a("Дилер"),s.form.need_percent_price?(o(),i("span",ne,", %")):(o(),i("span",de,", руб"))])])]),e("div",ce,[e("div",ae,[h(e("input",{type:"number","onUpdate:modelValue":t[8]||(t[8]=l=>s.form.price.cost=l),class:"form-control",id:"price-cost",required:""},null,512),[[m,s.form.price.cost]]),e("label",_e,[a("Себестоимость"),s.form.need_percent_price?(o(),i("span",he,", %")):(o(),i("span",me,", руб"))])])])])])]),e("div",ue,[e("div",pe,[s.messages.length>0?(o(!0),i(p,{key:0},v(s.messages,(l,k)=>(o(),i("div",fe,[ve,a(" "+u(l||"Ошибка")+" ",1),e("button",{type:"button",class:"btn-close",onClick:Nt=>_.removeMessage(k)},null,8,be)]))),256)):d("",!0)])]),e("div",ge,[e("div",ye,[e("button",{disabled:!_.needClearForm,class:"btn btn-dark rounded-0"},[s.loading?(o(),i("span",$e)):(o(),i("i",we)),a(" Сохранить сервис ")],8,ke),_.needClearForm&&!s.loading?(o(),i("button",{key:0,type:"button",onClick:t[9]||(t[9]=(...l)=>_.resetForm&&_.resetForm(...l)),class:"btn btn-outline-secondary rounded-0 ml-2"},[Se,a(" Очистить форму ")])):d("",!0)])])],32)}const y=x(L,[["render",Ce]]),Ve={class:"row"},je={class:"col-12"},Fe={class:"input-group mb-3"},Ie={class:"form-floating"},Ue=e("label",{for:"search-services"},"Поиск по доступным сервисам",-1),xe=e("i",{class:"fa-solid fa-magnifying-glass"},null,-1),Le=[xe],Me={style:{"overflow-y":"auto"}},Ae={key:0,class:"table"},Oe={key:0},Pe=e("i",{class:"fa-solid fa-caret-down"},null,-1),Te=[Pe],Ne={key:1},qe=e("i",{class:"fa-solid fa-caret-up"},null,-1),Be=[qe],De=e("th",{scope:"col",class:"text-center"},"Действие",-1),Ee={key:0},Ge=e("i",{class:"fa-solid fa-caret-down"},null,-1),Je=[Ge],Ze={key:1},ze=e("i",{class:"fa-solid fa-caret-up"},null,-1),He=[ze],Ke={key:0},Qe=e("i",{class:"fa-solid fa-caret-down"},null,-1),Re=[Qe],We={key:1},Xe=e("i",{class:"fa-solid fa-caret-up"},null,-1),Ye=[Xe],et=j('<table class="w-100"><thead><th style="width:100px;">опт</th><th style="width:100px;">дилер</th><th style="width:100px;">розница</th><th style="width:100px;">себестоимость</th></thead><tbody></tbody></table>',1),tt={scope:"row"},st={class:"text-center"},ot={class:"dropdown"},it=e("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-bars"})],-1),lt={class:"dropdown-menu"},rt=["onClick"],nt=e("i",{class:"fa-solid fa-pen mr-2"},null,-1),dt=["onClick"],ct=e("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),at=["onClick"],_t={class:"text-center"},ht={class:"w-100"},mt={style:{width:"100px","text-align":"center"}},ut={style:{width:"100px","text-align":"center"}},pt={style:{width:"100px","text-align":"center"}},ft={style:{width:"100px","text-align":"center"}},vt={key:0,class:"alert alert-success",role:"alert"},bt=e("h4",{class:"alert-heading"},"Варианты дверей",-1),gt=e("p",null,"К сожалению, раздел Варианты дверей пуст. Вы еще не добавили ни одного варианта дверей, которые можно отобразить на этой странице.",-1),yt=e("hr",null,null,-1),kt=e("p",{class:"mb-0"},"Воспользуйтесь формой выше и добавьте свой первый вариант дверей",-1),wt=[bt,gt,yt,kt],$t={key:1,class:"row mb-3"},St={class:"col-12"},Ct={class:"modal fade",id:"service-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Vt={class:"modal-dialog modal-lg"},jt={class:"modal-content rounded-0"},Ft={class:"modal-body"},It={data(){return{editor_modal:null,selected_item:null,sort:{column:null,direction:"desc"},search:null,current_page:0,paginate_object:null,items:[{id:null,title:null,price:{wholesale:0,dealer:0,retail:0,cost:0},type:null,description:null,is_active:!0,order_position:0}]}},computed:{...V(["getServices","getServicesPaginateObject"])},mounted(){this.loadServices(),this.editor_modal=new bootstrap.Modal(document.getElementById("service-editor-modal"),{})},methods:{sortAndLoad(r){this.sort.column=r,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadServices(this.current_page)},loadServices(r=0){this.current_page=r,this.$store.dispatch("loadServices",{dataObject:{search:this.search,order:this.sort.column,direction:this.sort.direction},page:this.current_page}).then(t=>{this.items=this.getServices,this.paginate_object=this.getServicesPaginateObject}).catch(()=>{this.loading=!1})},selectItem(r){if(r==null){this.selected_item=null,this.editor_modal.hide();return}this.selected_item=null,this.$nextTick(()=>{this.selected_item=r,this.editor_modal.show()})},duplicateItem(r){this.$store.dispatch("duplicateDoorVariant",{doorVariantId:r}).then(()=>{this.sortAndLoad("id")})},removeItem(r){this.$store.dispatch("removeDoorVariant",{doorVariantId:r}).then(()=>{this.sortAndLoad("id")})}}},Ut=Object.assign(It,{__name:"ServiceTable",setup(r){return(t,n)=>(o(),i(p,null,[e("form",Ve,[e("div",je,[e("div",Fe,[e("div",Ie,[h(e("input",{type:"search","onUpdate:modelValue":n[0]||(n[0]=c=>t.search=c),class:"form-control",id:"search-services"},null,512),[[m,t.search]]),Ue]),e("button",{type:"button",onClick:n[1]||(n[1]=c=>t.sortAndLoad("id")),class:"btn btn-outline-secondary rounded-0"},Le)])])]),e("div",Me,[t.items.length>0?(o(),i("table",Ae,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:n[2]||(n[2]=c=>t.sortAndLoad("id"))},[a("# "),t.sort.direction==="desc"&&t.sort.column==="id"?(o(),i("span",Oe,Te)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="id"?(o(),i("span",Ne,Be)):d("",!0)]),De,e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[3]||(n[3]=c=>t.sortAndLoad("title"))},[a("Название "),t.sort.direction==="desc"&&t.sort.column==="title"?(o(),i("span",Ee,Je)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="title"?(o(),i("span",Ze,He)):d("",!0)]),e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[4]||(n[4]=c=>t.sortAndLoad("price"))},[a("Цена, ₽ "),t.sort.direction==="desc"&&t.sort.column==="price"?(o(),i("span",Ke,Re)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="price"?(o(),i("span",We,Ye)):d("",!0),et])])]),e("tbody",null,[(o(!0),i(p,null,v(t.items,(c,s)=>(o(),i("tr",null,[e("th",tt,u(c.id||s),1),e("td",st,[e("div",ot,[it,e("ul",lt,[e("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.selectItem(c),href:"javascript:void(0)"},[nt,a("Редактировать")],8,rt)]),e("li",null,[e("a",{class:"dropdown-item text-danger",onClick:_=>t.removeItem(c.id),href:"javascript:void(0)"},[ct,a("Удалить")],8,dt)])])])]),e("td",{class:"text-center",onClick:_=>t.selectItem(c)},u(c.title||"-"),9,at),e("td",_t,[e("table",ht,[e("tbody",null,[e("tr",null,[e("td",mt,u(t.items[s].price.wholesale||0),1),e("td",ut,u(t.items[s].price.dealer||0),1),e("td",pt,u(t.items[s].price.retail||0),1),e("td",ft,u(t.items[s].price.cost||0),1)])])])])]))),256))])])):d("",!0)]),t.items.length===0?(o(),i("div",vt,wt)):d("",!0),t.items.length>0?(o(),i("div",$t,[e("div",St,[t.paginate_object?(o(),f(U,{key:0,onPagination_page:t.loadServices,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])])):d("",!0),e("div",Ct,[e("div",Vt,[e("div",jt,[e("div",Ft,[t.selected_item?(o(),f(y,{key:0,item:t.selected_item,onCallback:n[5]||(n[5]=c=>t.selectItem(null))},null,8,["item"])):d("",!0)])])])])],64))}}),xt=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Сервисы",-1),Lt={class:"py-12"},Mt={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},At={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Ot={class:"p-6 text-gray-900"},Pt=e("hr",{class:"hr my-5"},null,-1),Tt={data(){return{loading:!1,selectedService:null}},methods:{selectService(r){this.selectedService=r,this.loading=!0,this.$nextTick(()=>{this.loading=!1})},callbackServiceForm(){this.loading=!0,this.selectedService=null,this.$nextTick(()=>{this.loading=!1})}}},Zt=Object.assign(Tt,{__name:"ServicesPage",setup(r){return(t,n)=>(o(),i(p,null,[b(F(I),{title:"Сервисы"}),b(w,null,{header:g(()=>[xt]),default:g(()=>[e("div",Lt,[e("div",Mt,[e("div",At,[e("div",Ot,[t.loading?d("",!0):(o(),f(y,{key:0,item:t.selectedService,onCallback:t.callbackServiceForm},null,8,["item","onCallback"])),Pt,t.loading?d("",!0):(o(),f(Ut,{key:1,onSelect:t.selectService},null,8,["onSelect"]))])])])])]),_:1})],64))}});export{Zt as default};
