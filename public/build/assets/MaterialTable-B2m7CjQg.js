import{o as s,c as i,b as e,g as h,v as p,h as b,f as d,F as g,r as f,d as u,j as w,t as v,m as k,e as y}from"./app-BNSmz6kg.js";import{P as $}from"./Pagination-DddiYI7y.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={props:["item"],data(){return{messages:[],uploaded_wrapper_image:[],uploaded_door_image:[],loading:!1,form:{id:null,title:null,is_base:!1,order_position:0,need_generate_sizes:!1,wrapper_variants:[],door_variants:[]}}},computed:{needClearForm(){return this.form.id||this.form.title||this.uploaded_wrapper_image.length>0||this.uploaded_door_image.length>0}},mounted(){this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,title:this.item.title||null,is_base:this.item.is_base||!1,order_position:this.item.order_position||0,wrapper_variants:this.item.wrapper_variants||[],door_variants:this.item.door_variants||[]}})},methods:{alert(o){this.messages.push(o)},resetForm(){this.uploaded_wrapper_image=[],this.uploaded_door_image=[],this.form.id=null,this.form.title=null,this.form.order_position=0,this.form.is_base=!1,this.form.wrapper_variants=[],this.form.door_variants=[],this.$refs.doorImageRef.value=null,this.$refs.wrapperImageRef.value=null,this.$emit("callback")},removeUploadedPhoto(o,t){this.form[o].splice(t,1)},removePhoto(o,t){this[o].splice(t,1)},getPhoto(o){return{imageUrl:URL.createObjectURL(o)}},onChangePhotos(o,t){const n=t.target.files;for(let c=0;c<n.length;c++)this[o].push({image:n[c],title:null,description:null})},removeMessage(o){this.messages.splice(o,1)},submit(){let o=new FormData;if(Object.keys(this.form).forEach(t=>{const n=this.form[t]||"";typeof n=="object"?o.append(t,JSON.stringify(n)):o.append(t,n)}),this.uploaded_wrapper_image.length>0){for(let t=0;t<this.uploaded_wrapper_image.length;t++)o.append("wrapper_images[]",this.uploaded_wrapper_image[t].image),this.uploaded_wrapper_image[t].image_name=this.uploaded_wrapper_image[t].image.name||null;o.append("wrapper_images_info",JSON.stringify(this.uploaded_wrapper_image))}if(this.uploaded_door_image.length>0){for(let t=0;t<this.uploaded_door_image.length;t++)o.append("door_images[]",this.uploaded_door_image[t].image),this.uploaded_door_image[t].image_name=this.uploaded_door_image[t].image.name||null;o.append("door_images_info",JSON.stringify(this.uploaded_door_image))}this.$store.dispatch("storeMaterial",{materialForm:o}).then(t=>{this.resetForm(),this.$emit("callback")}).catch(t=>{this.alert(t.response.data.message)})}}},V={class:"row"},j={class:"col-md-6 col-12"},x={class:"form-floating mb-3"},I=e("label",{for:"material-title"},"Название материала",-1),M={class:"col-md-6 col-12"},P={class:"form-floating mb-3"},L=e("label",{for:"material-order-position"},"Позиция материала в выдаче",-1),T={class:"form-check form-switch mb-3"},F=e("label",{class:"form-check-label",for:"is-base"}," Является базой ",-1),O={class:"form-check form-switch mb-3"},q=e("label",{class:"form-check-label",for:"recount-by-width"}," Автоматически создать заглушки размеров ",-1),A={class:"form-floating mb-3 border-gray-100 border"},N=e("label",{for:"door-material"},"Текстура материала для двери",-1),R={class:"row"},B={key:0,class:"col-12"},S=e("h6",{class:"font-bold my-3"},"Новые фотографии к материалу",-1),D=[S],z={class:"col-md-4 mb-2 image-preview d-flex align-items-start"},E={class:"card w-100"},J=["src"],G={class:"card-body d-flex justify-center"},W=["onClick"],H={class:"card-body"},K={class:"form-floating mb-3"},Q=["onUpdate:modelValue"],X=e("label",{for:"floatingInput"},"Название",-1),Y={class:"form-floating"},Z=["onUpdate:modelValue"],ee=e("label",{for:"floatingTextarea"},"Описание",-1),te={key:1,class:"col-12"},oe=e("h6",{class:"font-bold my-3"},"Текущие фотографии к материалу",-1),se=[oe],ie={class:"col-md-4 mb-2 image-preview d-flex align-items-start"},ae={class:"card w-100"},le=["src"],re=["src"],de={class:"card-body d-flex justify-center"},ne=["onClick"],ce={class:"card-body"},me={class:"form-floating mb-3"},_e=["onUpdate:modelValue"],he=e("label",{for:"floatingInput"},"Название",-1),pe={class:"form-floating"},ue=["onUpdate:modelValue"],ge=e("label",{for:"floatingTextarea"},"Описание",-1),fe={class:"form-floating mb-3 border-gray-100 border"},ve=e("label",{for:"material-wrapper"},"Текстура материала вокруг двери",-1),be={class:"row"},ye={key:0,class:"col-12"},we=e("h6",{class:"font-bold my-3"},"Новые фотографии к материалу",-1),ke=[we],$e={class:"col-md-6 mb-2 image-preview d-flex align-items-start"},Ce={class:"card w-100 rounded-0"},Ue=["src"],Ve={class:"card-body d-flex justify-center"},je=["onClick"],xe={class:"card-body"},Ie={class:"form-floating mb-2"},Me=["onUpdate:modelValue"],Pe=e("label",{for:"floatingInput"},"Название",-1),Le={class:"form-floating"},Te=["onUpdate:modelValue"],Fe=e("label",{for:"floatingTextarea"},"Описание",-1),Oe={key:1,class:"col-12"},qe=e("h6",{class:"font-bold my-3"},"Текущие фотографии к материалу",-1),Ae=[qe],Ne={class:"col-md-6 mb-2 image-preview d-flex align-items-start"},Re={class:"card w-100 p-1 rounded-0"},Be=["src"],Se=["src"],De={class:"card-body d-flex justify-center"},ze=["onClick"],Ee={class:"card-body"},Je={class:"form-floating mb-2"},Ge=["onUpdate:modelValue"],We=e("label",{for:"floatingInput"},"Название",-1),He={class:"form-floating"},Ke=["onUpdate:modelValue"],Qe=e("label",{for:"floatingTextarea"},"Описание",-1),Xe={class:"row"},Ye={class:"col-12"},Ze={class:"alert alert-danger alert-dismissible fade show",role:"alert"},et=e("strong",null,"Внимание!",-1),tt=["onClick"],ot={class:"row mt-5"},st={class:"col-12 d-flex justify-content-center"},it=["disabled"],at={key:0,class:"fa-regular fa-floppy-disk mr-1"},lt={key:1,class:"spinner-border spinner-border-sm text-success",role:"status"},rt=e("i",{class:"fa-solid fa-xmark mr-1"},null,-1);function dt(o,t,n,c,a,_){return s(),i("form",{action:"",onSubmit:t[7]||(t[7]=w((...l)=>_.submit&&_.submit(...l),["prevent"]))},[e("div",V,[e("div",j,[e("div",x,[h(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=l=>a.form.title=l),class:"form-control",id:"material-title",placeholder:"name@example.com",required:""},null,512),[[p,a.form.title]]),I])]),e("div",M,[e("div",P,[h(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=l=>a.form.order_position=l),class:"form-control",id:"material-order-position",placeholder:"name@example.com",required:""},null,512),[[p,a.form.order_position]]),L])])]),e("div",T,[h(e("input",{class:"form-check-input","onUpdate:modelValue":t[2]||(t[2]=l=>a.form.is_base=l),type:"checkbox",role:"switch",id:"is-base"},null,512),[[b,a.form.is_base]]),F]),e("div",O,[h(e("input",{class:"form-check-input","onUpdate:modelValue":t[3]||(t[3]=l=>a.form.need_generate_sizes=l),type:"checkbox",role:"switch",id:"recount-by-width"},null,512),[[b,a.form.need_generate_sizes]]),q]),e("div",A,[e("input",{type:"file",class:"form-control",accept:"image/*",id:"door-material",ref:"doorImageRef",onChange:t[4]||(t[4]=l=>_.onChangePhotos("uploaded_door_image",l)),placeholder:"name@example.com",multiple:""},null,544),N]),e("div",R,[a.uploaded_door_image.length>0?(s(),i("div",B,D)):d("",!0),(s(!0),i(g,null,f(a.uploaded_door_image,(l,r)=>(s(),i("div",z,[e("div",E,[e("img",{style:{"min-height":"200px"},src:_.getPhoto(l.image).imageUrl,class:"card-img-top uploaded-image-mini",alt:""},null,8,J),e("div",G,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:m=>_.removePhoto("uploaded_door_image",r)},"Удалить фото",8,W)]),e("div",H,[e("div",K,[h(e("input",{type:"text","onUpdate:modelValue":m=>a.uploaded_door_image[r].title=m,class:"form-control border-gray-300 rounded-md",id:"floatingInput",required:""},null,8,Q),[[p,a.uploaded_door_image[r].title]]),X]),e("div",Y,[h(e("textarea",{class:"form-control","onUpdate:modelValue":m=>a.uploaded_door_image[r].description=m,placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,8,Z),[[p,a.uploaded_door_image[r].description]]),ee])])])]))),256)),a.form.door_variants.length>0?(s(),i("div",te,se)):d("",!0),(s(!0),i(g,null,f(a.form.door_variants,(l,r)=>(s(),i("div",ie,[e("div",ae,[l.image.indexOf("http")===-1?(s(),i("img",{key:0,style:{"min-height":"200px"},src:"/images/"+l.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,le)):(s(),i("img",{key:1,style:{"min-height":"200px"},src:l.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,re)),e("div",de,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:m=>_.removeUploadedPhoto("door_variants",r)},"Удалить",8,ne)]),e("div",ce,[e("div",me,[h(e("input",{type:"text","onUpdate:modelValue":m=>a.form.door_variants[r].title=m,class:"form-control border-gray-300 rounded-md",id:"floatingInput",required:""},null,8,_e),[[p,a.form.door_variants[r].title]]),he]),e("div",pe,[h(e("textarea",{class:"form-control","onUpdate:modelValue":m=>a.form.door_variants[r].description=m,placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,8,ue),[[p,a.form.door_variants[r].description]]),ge])])])]))),256))]),e("div",fe,[e("input",{type:"file",class:"form-control",id:"material-wrapper",accept:"image/*",ref:"wrapperImageRef",onChange:t[5]||(t[5]=l=>_.onChangePhotos("uploaded_wrapper_image",l)),placeholder:"name@example.com",multiple:""},null,544),ve]),e("div",be,[a.uploaded_wrapper_image.length>0?(s(),i("div",ye,ke)):d("",!0),(s(!0),i(g,null,f(a.uploaded_wrapper_image,(l,r)=>(s(),i("div",$e,[e("div",Ce,[e("img",{style:{"min-height":"200px"},src:_.getPhoto(l.image).imageUrl,class:"card-img-top uploaded-image-mini",alt:""},null,8,Ue),e("div",Ve,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:m=>_.removePhoto("uploaded_wrapper_image",r)},"Удалить фото",8,je)]),e("div",xe,[e("div",Ie,[h(e("input",{type:"text","onUpdate:modelValue":m=>a.uploaded_wrapper_image[r].title=m,class:"form-control rounded-0 border-gray-300",id:"floatingInput"},null,8,Me),[[p,a.uploaded_wrapper_image[r].title]]),Pe]),e("div",Le,[h(e("textarea",{class:"form-control rounded-0","onUpdate:modelValue":m=>a.uploaded_wrapper_image[r].description=m,placeholder:"Leave a comment here",id:"floatingTextarea"},null,8,Te),[[p,a.uploaded_wrapper_image[r].description]]),Fe])])])]))),256)),a.form.wrapper_variants.length>0?(s(),i("div",Oe,Ae)):d("",!0),(s(!0),i(g,null,f(a.form.wrapper_variants,(l,r)=>(s(),i("div",Ne,[e("div",Re,[l.image.indexOf("http")===-1?(s(),i("img",{key:0,style:{"min-height":"200px"},src:"/images/"+l.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,Be)):(s(),i("img",{key:1,style:{"min-height":"200px"},src:l.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,Se)),e("div",De,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:m=>_.removeUploadedPhoto("wrapper_variants",r)},"Удалить",8,ze)]),e("div",Ee,[e("div",Je,[h(e("input",{type:"text","onUpdate:modelValue":m=>a.form.wrapper_variants[r].title=m,class:"form-control border-gray-300 rounded-0",id:"floatingInput",required:""},null,8,Ge),[[p,a.form.wrapper_variants[r].title]]),We]),e("div",He,[h(e("textarea",{class:"form-control rounded-0","onUpdate:modelValue":m=>a.form.wrapper_variants[r].description=m,placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,8,Ke),[[p,a.form.wrapper_variants[r].description]]),Qe])])])]))),256))]),e("div",Xe,[e("div",Ye,[a.messages.length>0?(s(!0),i(g,{key:0},f(a.messages,(l,r)=>(s(),i("div",Ze,[et,u(" "+v(l||"Ошибка")+" ",1),e("button",{type:"button",class:"btn-close",onClick:m=>_.removeMessage(r)},null,8,tt)]))),256)):d("",!0)])]),e("div",ot,[e("div",st,[e("button",{disabled:!_.needClearForm,class:"btn btn-dark rounded-0"},[a.loading?(s(),i("span",lt)):(s(),i("i",at)),u(" Сохранить материал ")],8,it),_.needClearForm&&!a.loading?(s(),i("button",{key:0,type:"button",onClick:t[6]||(t[6]=(...l)=>_.resetForm&&_.resetForm(...l)),class:"btn btn-outline-danger rounded-0 ml-2"},[rt,u(" Очистить форму ")])):d("",!0)])])],32)}const nt=C(U,[["render",dt]]),ct={class:"row"},mt={class:"col-12"},_t={class:"input-group mb-3"},ht={class:"form-floating"},pt=e("label",{for:"search-materials"},"Поиск по материалам",-1),ut=e("i",{class:"fa-solid fa-magnifying-glass"},null,-1),gt=[ut],ft={style:{"overflow-y":"auto"}},vt={key:0,class:"table"},bt={key:0},yt=e("i",{class:"fa-solid fa-caret-down"},null,-1),wt=[yt],kt={key:1},$t=e("i",{class:"fa-solid fa-caret-up"},null,-1),Ct=[$t],Ut={key:0,scope:"col",class:"text-center"},Vt={key:0},jt=e("i",{class:"fa-solid fa-caret-down"},null,-1),xt=[jt],It={key:1},Mt=e("i",{class:"fa-solid fa-caret-up"},null,-1),Pt=[Mt],Lt={key:0},Tt=e("i",{class:"fa-solid fa-caret-down"},null,-1),Ft=[Tt],Ot={key:1},qt=e("i",{class:"fa-solid fa-caret-up"},null,-1),At=[qt],Nt={key:2,scope:"col",class:"text-center"},Rt={key:3,scope:"col",class:"text-center"},Bt={scope:"row"},St={key:0,class:"text-center"},Dt={class:"dropdown"},zt=e("button",{class:"btn btn-link",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa-solid fa-bars"})],-1),Et={class:"dropdown-menu"},Jt=["onClick"],Gt=e("i",{class:"fa-solid fa-pen mr-2"},null,-1),Wt=["onClick"],Ht=e("i",{class:"fa-regular fa-copy mr-2"},null,-1),Kt=["onClick"],Qt=e("i",{class:"fa-solid fa-trash-can mr-2"},null,-1),Xt={class:"text-center cursor-pointer"},Yt={key:1,class:"text-center"},Zt={key:2,class:"text-center"},eo={key:3,class:"text-center"},to={key:0,class:"alert alert-success",role:"alert"},oo=e("h4",{class:"alert-heading"},"Материалы",-1),so=e("p",null,"К сожалению, раздел материалов пуст. Вы еще не добавили ни одного материала, который можно отобразить на этой странице.",-1),io=e("hr",null,null,-1),ao=e("p",{class:"mb-0"},"Воспользуйтесь формой выше и добавьте свой первый материал",-1),lo=[oo,so,io,ao],ro={key:1,class:"row mb-3"},no={class:"col-12"},co={class:"modal fade",id:"material-editor-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},mo={class:"modal-dialog modal-lg"},_o={class:"modal-content rounded-0"},ho={class:"modal-body"},po={props:["simple"],data(){return{editor_modal:null,selected_item:null,sort:{column:null,direction:"desc"},search:null,current_page:0,paginate_object:null,items:[{id:null,title:null,wrapper_variants:[],door_variants:[]}]}},computed:{...k(["getMaterialsPaginateObject","getMaterials"])},mounted(){this.loadMaterials(),this.editor_modal=new bootstrap.Modal(document.getElementById("material-editor-modal"),{})},methods:{sortAndLoad(o){this.sort.column=o,this.sort.direction=this.sort.direction==="desc"?"asc":"desc",this.loadMaterials(this.current_page)},loadMaterials(o=0){this.current_page=o,this.$store.dispatch("loadMaterials",{dataObject:{search:this.search,order:this.sort.column,direction:this.sort.direction},page:this.current_page}).then(t=>{this.items=this.getMaterials,this.paginate_object=this.getMaterialsPaginateObject}).catch(()=>{this.loading=!1})},selectItem(o){if(o==null){this.selected_item=null,this.editor_modal.hide();return}this.selected_item=null,this.$nextTick(()=>{this.selected_item=o,this.editor_modal.show()})},duplicateItem(o){this.$store.dispatch("duplicateMaterial",{materialId:o}).then(()=>{this.sortAndLoad("id")})},removeItem(o){this.$store.dispatch("removeMaterial",{materialId:o}).then(()=>{this.sortAndLoad("id")})},showWrapperVariants(o){this.$emit("show-wrapper-variants",o.wrapper_variants)},showDoorVariants(o){this.$emit("show-door-variants",o.door_variants)}}},vo=Object.assign(po,{__name:"MaterialTable",setup(o){return(t,n)=>(s(),i(g,null,[e("form",ct,[e("div",mt,[e("div",_t,[e("div",ht,[h(e("input",{type:"search","onUpdate:modelValue":n[0]||(n[0]=c=>t.search=c),class:"form-control",id:"search-materials"},null,512),[[p,t.search]]),pt]),e("button",{type:"button",onClick:n[1]||(n[1]=c=>t.sortAndLoad("id")),class:"btn btn-outline-secondary rounded-0"},gt)])])]),e("div",ft,[t.items.length>0?(s(),i("table",vt,[e("thead",null,[e("tr",null,[e("th",{scope:"col",class:"cursor-pointer",onClick:n[2]||(n[2]=c=>t.sortAndLoad("id"))},[u("# "),t.sort.direction==="desc"&&t.sort.column==="id"?(s(),i("span",bt,wt)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="id"?(s(),i("span",kt,Ct)):d("",!0)]),o.simple?d("",!0):(s(),i("th",Ut,"Действие ")),e("th",{scope:"col",class:"text-center cursor-pointer",onClick:n[3]||(n[3]=c=>t.sortAndLoad("title"))},[u("Название "),t.sort.direction==="desc"&&t.sort.column==="title"?(s(),i("span",Vt,xt)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="title"?(s(),i("span",It,Pt)):d("",!0)]),o.simple?d("",!0):(s(),i("th",{key:1,scope:"col",class:"text-center cursor-pointer",onClick:n[4]||(n[4]=c=>t.sortAndLoad("order_position"))},[u("Позиция в выдаче "),t.sort.direction==="desc"&&t.sort.column==="order_position"?(s(),i("span",Lt,Ft)):d("",!0),t.sort.direction==="asc"&&t.sort.column==="order_position"?(s(),i("span",Ot,At)):d("",!0)])),o.simple?d("",!0):(s(),i("th",Nt,"Варианты двери ")),o.simple?d("",!0):(s(),i("th",Rt,"Варианты контура вокруг "))])]),e("tbody",null,[(s(!0),i(g,null,f(t.items,(c,a)=>(s(),i("tr",null,[e("th",Bt,v(c.id||a),1),o.simple?d("",!0):(s(),i("td",St,[e("div",Dt,[zt,e("ul",Et,[e("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.selectItem(c),href:"javascript:void(0)"},[Gt,u("Редактировать")],8,Jt)]),e("li",null,[e("a",{class:"dropdown-item",onClick:_=>t.duplicateItem(c.id),href:"javascript:void(0)"},[Ht,u("Дублировать")],8,Wt)]),e("li",null,[e("a",{class:"dropdown-item text-danger",onClick:_=>t.removeItem(c.id),href:"javascript:void(0)"},[Qt,u("Удалить")],8,Kt)])])])])),e("td",Xt,v(c.title||"-"),1),o.simple?d("",!0):(s(),i("td",Yt,v(c.order_position||0),1)),o.simple?d("",!0):(s(),i("td",Zt,v((c.door_variants||[]).length),1)),o.simple?d("",!0):(s(),i("td",eo,v((c.wrapper_variants||[]).length),1))]))),256))])])):d("",!0)]),t.items.length===0?(s(),i("div",to,lo)):d("",!0),t.items.length>0?(s(),i("div",ro,[e("div",no,[t.paginate_object?(s(),y($,{key:0,onPagination_page:t.loadMaterials,pagination:t.paginate_object},null,8,["onPagination_page","pagination"])):d("",!0)])])):d("",!0),e("div",co,[e("div",mo,[e("div",_o,[e("div",ho,[t.selected_item?(s(),y(nt,{key:0,item:t.selected_item,onCallback:n[5]||(n[5]=c=>t.selectItem(null))},null,8,["item"])):d("",!0)])])])])],64))}});export{nt as M,vo as _};
