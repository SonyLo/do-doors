import{_ as w}from"./AuthenticatedLayout-BgS8ra26.js";import"./CalcForm-D8u4Ixna.js";import{_ as x}from"./MaterialTable-DFoozYmX.js";import{o as a,c as r,b as e,f as c,v as m,h as k,e as p,F as h,r as u,g as f,j as U,t as C,a as v,u as V,w as b,Z as M,d as y}from"./app-7qqAFMKY.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-EPKIK_Fn.js";import"./RalColorSelector-Bl0lesMZ.js";import"./Pagination-CPmGs_nE.js";const F={props:["item"],data(){return{messages:[],uploaded_wrapper_image:[],uploaded_door_image:[],loading:!1,form:{id:null,title:null,order_position:0,need_generate_sizes:!1,wrapper_variants:[],door_variants:[]}}},computed:{needClearForm(){return this.form.id||this.form.title||this.uploaded_wrapper_image.length>0||this.uploaded_door_image.length>0}},mounted(){this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,title:this.item.title||null,order_position:this.item.order_position||0,wrapper_variants:this.item.wrapper_variants||[],door_variants:this.item.door_variants||[]}})},methods:{alert(l){this.messages.push(l)},resetForm(){this.uploaded_wrapper_image=[],this.uploaded_door_image=[],this.form.id=null,this.form.title=null,this.form.order_position=0,this.form.wrapper_variants=[],this.form.door_variants=[],this.$refs.doorImageRef.value=null,this.$refs.wrapperImageRef.value=null,this.$emit("callback")},removeUploadedPhoto(l,o){this.form[l].splice(o,1)},removePhoto(l,o){this[l].splice(o,1)},getPhoto(l){return{imageUrl:URL.createObjectURL(l)}},onChangePhotos(l,o){const _=o.target.files;for(let g=0;g<_.length;g++)this[l].push({image:_[g],title:null,description:null})},removeMessage(l){this.messages.splice(l,1)},submit(){let l=new FormData;if(Object.keys(this.form).forEach(o=>{const _=this.form[o]||"";typeof _=="object"?l.append(o,JSON.stringify(_)):l.append(o,_)}),this.uploaded_wrapper_image.length>0){for(let o=0;o<this.uploaded_wrapper_image.length;o++)l.append("wrapper_images[]",this.uploaded_wrapper_image[o].image),this.uploaded_wrapper_image[o].image_name=this.uploaded_wrapper_image[o].image.name||null;l.append("wrapper_images_info",JSON.stringify(this.uploaded_wrapper_image))}if(this.uploaded_door_image.length>0){for(let o=0;o<this.uploaded_door_image.length;o++)l.append("door_images[]",this.uploaded_door_image[o].image),this.uploaded_door_image[o].image_name=this.uploaded_door_image[o].image.name||null;l.append("door_images_info",JSON.stringify(this.uploaded_door_image))}this.$store.dispatch("storeMaterial",{materialForm:l}).then(o=>{this.resetForm(),this.$emit("callback")}).catch(o=>{this.alert(o.response.data.message)})}}},P={class:"row"},T={class:"col-md-6 col-12"},I={class:"form-floating mb-3"},q=e("label",{for:"material-title"},"Название материала",-1),O={class:"col-md-6 col-12"},L={class:"form-floating mb-3"},N=e("label",{for:"material-order-position"},"Позиция материала в выдаче",-1),S={class:"form-check form-switch"},R=e("label",{class:"form-check-label",for:"recount-by-width"}," Автоматически создать заглушки размеров ",-1),B={class:"form-floating mb-3 border-gray-100 border"},z=e("label",{for:"door-material"},"Текстура материала для двери",-1),D={class:"row"},J={key:0,class:"col-12"},E=e("h6",{class:"font-bold my-3"},"Новые фотографии к материалу",-1),Z=[E],A={class:"col-md-4 mb-2 image-preview d-flex align-items-start"},G={class:"card w-100"},H=["src"],K={class:"card-body d-flex justify-center"},Q=["onClick"],W={class:"card-body"},X={class:"form-floating mb-3"},Y=["onUpdate:modelValue"],$=e("label",{for:"floatingInput"},"Название",-1),ee={class:"form-floating"},oe=["onUpdate:modelValue"],te=e("label",{for:"floatingTextarea"},"Описание",-1),se={key:1,class:"col-12"},ie=e("h6",{class:"font-bold my-3"},"Текущие фотографии к материалу",-1),ae=[ie],le={class:"col-md-4 mb-2 image-preview d-flex align-items-start"},re={class:"card w-100"},de=["src"],ne=["src"],ce={class:"card-body d-flex justify-center"},me=["onClick"],_e={class:"card-body"},pe={class:"form-floating mb-3"},he=["onUpdate:modelValue"],ue=e("label",{for:"floatingInput"},"Название",-1),ge={class:"form-floating"},fe=["onUpdate:modelValue"],ve=e("label",{for:"floatingTextarea"},"Описание",-1),be={class:"form-floating mb-3 border-gray-100 border"},ye=e("label",{for:"material-wrapper"},"Текстура материала вокруг двери",-1),we={class:"row"},xe={key:0,class:"col-12"},ke=e("h6",{class:"font-bold my-3"},"Новые фотографии к материалу",-1),Ue=[ke],Ce={class:"col-md-4 mb-2 image-preview d-flex align-items-start"},Ve={class:"card w-100"},Me=["src"],je={class:"card-body d-flex justify-center"},Fe=["onClick"],Pe={class:"card-body"},Te={class:"form-floating mb-3"},Ie=["onUpdate:modelValue"],qe=e("label",{for:"floatingInput"},"Название",-1),Oe={class:"form-floating"},Le=["onUpdate:modelValue"],Ne=e("label",{for:"floatingTextarea"},"Описание",-1),Se={key:1,class:"col-12"},Re=e("h6",{class:"font-bold my-3"},"Текущие фотографии к материалу",-1),Be=[Re],ze={class:"col-md-4 mb-2 image-preview d-flex align-items-start"},De={class:"card w-100"},Je=["src"],Ee=["src"],Ze={class:"card-body d-flex justify-center"},Ae=["onClick"],Ge={class:"card-body"},He={class:"form-floating mb-3"},Ke=["onUpdate:modelValue"],Qe=e("label",{for:"floatingInput"},"Название",-1),We={class:"form-floating"},Xe=["onUpdate:modelValue"],Ye=e("label",{for:"floatingTextarea"},"Описание",-1),$e={class:"row"},eo={class:"col-12"},oo={class:"alert alert-danger alert-dismissible fade show",role:"alert"},to=e("strong",null,"Внимание!",-1),so=["onClick"],io={class:"row mt-5"},ao={class:"col-12 d-flex justify-content-center"},lo=["disabled"],ro={key:0,class:"fa-regular fa-floppy-disk mr-1"},no={key:1,class:"spinner-border spinner-border-sm text-success",role:"status"},co=e("i",{class:"fa-solid fa-xmark mr-1"},null,-1);function mo(l,o,_,g,t,n){return a(),r("form",{action:"",onSubmit:o[6]||(o[6]=U((...s)=>n.submit&&n.submit(...s),["prevent"]))},[e("div",P,[e("div",T,[e("div",I,[c(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>t.form.title=s),class:"form-control",id:"material-title",placeholder:"name@example.com",required:""},null,512),[[m,t.form.title]]),q])]),e("div",O,[e("div",L,[c(e("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=s=>t.form.order_position=s),class:"form-control",id:"material-order-position",placeholder:"name@example.com",required:""},null,512),[[m,t.form.order_position]]),N])])]),e("div",S,[c(e("input",{class:"form-check-input","onUpdate:modelValue":o[2]||(o[2]=s=>t.form.need_generate_sizes=s),type:"checkbox",role:"switch",id:"recount-by-width"},null,512),[[k,t.form.need_generate_sizes]]),R]),e("div",B,[e("input",{type:"file",class:"form-control",accept:"image/*",id:"door-material",ref:"doorImageRef",onChange:o[3]||(o[3]=s=>n.onChangePhotos("uploaded_door_image",s)),placeholder:"name@example.com",multiple:""},null,544),z]),e("div",D,[t.uploaded_door_image.length>0?(a(),r("div",J,Z)):p("",!0),(a(!0),r(h,null,u(t.uploaded_door_image,(s,i)=>(a(),r("div",A,[e("div",G,[e("img",{style:{"min-height":"200px"},src:n.getPhoto(s.image).imageUrl,class:"card-img-top uploaded-image-mini",alt:""},null,8,H),e("div",K,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:d=>n.removePhoto("uploaded_door_image",i)},"Удалить фото",8,Q)]),e("div",W,[e("div",X,[c(e("input",{type:"text","onUpdate:modelValue":d=>t.uploaded_door_image[i].title=d,class:"form-control border-gray-300 rounded-md",id:"floatingInput",required:""},null,8,Y),[[m,t.uploaded_door_image[i].title]]),$]),e("div",ee,[c(e("textarea",{class:"form-control","onUpdate:modelValue":d=>t.uploaded_door_image[i].description=d,placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,8,oe),[[m,t.uploaded_door_image[i].description]]),te])])])]))),256)),t.form.door_variants.length>0?(a(),r("div",se,ae)):p("",!0),(a(!0),r(h,null,u(t.form.door_variants,(s,i)=>(a(),r("div",le,[e("div",re,[s.image.indexOf("http")===-1?(a(),r("img",{key:0,style:{"min-height":"200px"},src:"/images/"+s.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,de)):(a(),r("img",{key:1,style:{"min-height":"200px"},src:s.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,ne)),e("div",ce,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:d=>n.removeUploadedPhoto("door_variants",i)},"Удалить",8,me)]),e("div",_e,[e("div",pe,[c(e("input",{type:"text","onUpdate:modelValue":d=>t.form.door_variants[i].title=d,class:"form-control border-gray-300 rounded-md",id:"floatingInput",required:""},null,8,he),[[m,t.form.door_variants[i].title]]),ue]),e("div",ge,[c(e("textarea",{class:"form-control","onUpdate:modelValue":d=>t.form.door_variants[i].description=d,placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,8,fe),[[m,t.form.door_variants[i].description]]),ve])])])]))),256))]),e("div",be,[e("input",{type:"file",class:"form-control",id:"material-wrapper",accept:"image/*",ref:"wrapperImageRef",onChange:o[4]||(o[4]=s=>n.onChangePhotos("uploaded_wrapper_image",s)),placeholder:"name@example.com",multiple:""},null,544),ye]),e("div",we,[t.uploaded_wrapper_image.length>0?(a(),r("div",xe,Ue)):p("",!0),(a(!0),r(h,null,u(t.uploaded_wrapper_image,(s,i)=>(a(),r("div",Ce,[e("div",Ve,[e("img",{style:{"min-height":"200px"},src:n.getPhoto(s.image).imageUrl,class:"card-img-top uploaded-image-mini",alt:""},null,8,Me),e("div",je,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:d=>n.removePhoto("uploaded_wrapper_image",i)},"Удалить фото",8,Fe)]),e("div",Pe,[e("div",Te,[c(e("input",{type:"text","onUpdate:modelValue":d=>t.uploaded_wrapper_image[i].title=d,class:"form-control border-gray-300 rounded-md",id:"floatingInput"},null,8,Ie),[[m,t.uploaded_wrapper_image[i].title]]),qe]),e("div",Oe,[c(e("textarea",{class:"form-control","onUpdate:modelValue":d=>t.uploaded_wrapper_image[i].description=d,placeholder:"Leave a comment here",id:"floatingTextarea"},null,8,Le),[[m,t.uploaded_wrapper_image[i].description]]),Ne])])])]))),256)),t.form.wrapper_variants.length>0?(a(),r("div",Se,Be)):p("",!0),(a(!0),r(h,null,u(t.form.wrapper_variants,(s,i)=>(a(),r("div",ze,[e("div",De,[s.image.indexOf("http")===-1?(a(),r("img",{key:0,style:{"min-height":"200px"},src:"/images/"+s.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,Je)):(a(),r("img",{key:1,style:{"min-height":"200px"},src:s.image,class:"card-img-top uploaded-image-mini",alt:""},null,8,Ee)),e("div",Ze,[e("a",{href:"javascript:void(0)",class:"text-danger",onClick:d=>n.removeUploadedPhoto("wrapper_variants",i)},"Удалить",8,Ae)]),e("div",Ge,[e("div",He,[c(e("input",{type:"text","onUpdate:modelValue":d=>t.form.wrapper_variants[i].title=d,class:"form-control border-gray-300 rounded-md",id:"floatingInput",required:""},null,8,Ke),[[m,t.form.wrapper_variants[i].title]]),Qe]),e("div",We,[c(e("textarea",{class:"form-control","onUpdate:modelValue":d=>t.form.wrapper_variants[i].description=d,placeholder:"Leave a comment here",id:"floatingTextarea",required:""},null,8,Xe),[[m,t.form.wrapper_variants[i].description]]),Ye])])])]))),256))]),e("div",$e,[e("div",eo,[t.messages.length>0?(a(!0),r(h,{key:0},u(t.messages,(s,i)=>(a(),r("div",oo,[to,f(" "+C(s||"Ошибка")+" ",1),e("button",{type:"button",class:"btn-close",onClick:d=>n.removeMessage(i)},null,8,so)]))),256)):p("",!0)])]),e("div",io,[e("div",ao,[e("button",{disabled:!n.needClearForm,class:"btn btn-dark rounded-0"},[t.loading?(a(),r("span",no)):(a(),r("i",ro)),f(" Сохранить материал ")],8,lo),n.needClearForm&&!t.loading?(a(),r("button",{key:0,type:"button",onClick:o[5]||(o[5]=(...s)=>n.resetForm&&n.resetForm(...s)),class:"btn btn-outline-danger rounded-0 ml-2"},[co,f(" Очистить форму ")])):p("",!0)])])],32)}const _o=j(F,[["render",mo]]),po=e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Материалы",-1),ho={class:"py-12"},uo={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},go={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},fo={class:"p-6 text-gray-900"},vo=e("hr",{class:"hr my-5"},null,-1),bo={data(){return{loading:!1,selectedMaterial:null}},methods:{selectMaterial(l){this.selectedMaterial=l,this.loading=!0,this.$nextTick(()=>{this.loading=!1})},callbackMaterialForm(){this.loading=!0,this.selectedMaterial=null,this.$nextTick(()=>{this.loading=!1})}}},jo=Object.assign(bo,{__name:"MaterialsPage",setup(l){return(o,_)=>(a(),r(h,null,[v(V(M),{title:"Материалы"}),v(w,null,{header:b(()=>[po]),default:b(()=>[e("div",ho,[e("div",uo,[e("div",go,[e("div",fo,[o.loading?p("",!0):(a(),y(_o,{key:0,item:o.selectedMaterial,onCallback:o.callbackMaterialForm},null,8,["item","onCallback"])),vo,o.loading?p("",!0):(a(),y(x,{key:1,onSelect:o.selectMaterial},null,8,["onSelect"]))])])])])]),_:1})],64))}});export{jo as default};
