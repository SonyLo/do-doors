import{_ as T}from"./AuthenticatedLayout-DMaCE6Fv.js";import"./CalcForm-BdOkST5D.js";import{o as i,c as o,b as s,d as p,v as _,e as k,t as g,f as d,F as n,r as b,h as B,g as v,j as D,k as V,l as E,p as q,q as N,w as $,s as L,x as J,y as M,u as P,a as O,Z}from"./app-Vnrh33h6.js";import{_ as A}from"./MaterialTable-DaN6rMAb.js";import{P as G,_ as H}from"./SizeTable2.vue_vue_type_style_index_0_lang-CVbhRKRr.js";import"./ApplicationLogo-D-GyZ-4m.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RalColorSelector-BmGihLqX.js";import"./Pagination-Cwg5JI-k.js";const K={class:"row"},Q={class:"col-12 col-md-6"},R={class:"form-floating mb-3"},W=s("label",{for:"size-width"},"Ширина, см",-1),X={class:"col-12 col-md-6"},Y={class:"form-floating mb-3"},x=s("label",{for:"size-height"},"Высота, см",-1),I={class:"row"},ee={class:"col-12 col-md-6"},se={class:"form-floating mb-3"},te=s("label",{for:"size-price"},"Цена, руб",-1),le={class:"col-12 col-md-6"},ie={class:"form-floating mb-3"},oe=s("label",{for:"size-price-koef"},"Ценовой коэффициент",-1),ae={class:"form-floating mb-3"},re=s("label",{for:"size-loops-count"},"Число петель",-1),ne={key:0,class:"mb-2"},de=s("i",{class:"fa-solid fa-xmark ml-1 text-danger"},null,-1),ce=[de],he=s("i",{class:"fa-solid fa-scroll mr-2"},null,-1),ue={class:"row mt-2"},me={class:"col-12"},pe={class:"alert alert-danger alert-dismissible fade show",role:"alert"},_e=s("strong",null,"Внимание!",-1),fe=["onClick"],be={class:"row mt-5"},ge={class:"col-12 d-flex justify-content-center"},ve=["disabled"],ye={key:0,class:"fa-regular fa-floppy-disk mr-1"},ke={key:1,class:"spinner-border spinner-border-sm text-success",role:"status"},$e=s("i",{class:"fa-solid fa-xmark mr-1"},null,-1),Me={class:"modal fade",id:"select-material-modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},we={class:"modal-dialog modal-lg"},ze={class:"modal-content"},Se={class:"modal-body"},Ce=s("div",{class:"modal-footer"},[s("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Закрыть")],-1),Fe={props:["item"],data(){return{materialModal:null,messages:[],loading:!1,loadingMaterial:!1,selectedMaterial:null,form:{id:null,width:0,height:0,material_id:null,price:0,price_koef:0,loops_count:0}}},computed:{needClearForm(){return this.form.id||this.form.width||this.form.height||this.form.size_id||this.form.price||this.form.price_koef||this.form.loops_count}},mounted(){this.materialModal=new bootstrap.Modal(document.getElementById("select-material-modal"),{}),this.item&&this.$nextTick(()=>{this.form={id:this.item.id||null,width:this.item.width||null,height:this.item.height||null,size_id:this.item.size_id||null,price:this.item.price||null,price_koef:this.item.price_koef||null,loops_count:this.item.loops_count||null,material_id:this.item.material_id||null},this.selectedMaterial=this.item.material||null})},methods:{removeSelectedMaterial(){this.selectedMaterial=null,this.form.material_id=null},openMaterialModal(){this.materialModal.show()},selectMaterial(a){this.selectedMaterial=a,this.form.material_id=a.id,this.loadingMaterial=!0,this.$nextTick(()=>{this.loadingMaterial=!1}),this.materialModal.hide()},alert(a){this.messages.push(a)},resetForm(){this.form={id:this.item.id||null,width:this.item.width||null,height:this.item.height||null,size_id:this.item.size_id||null,price:this.item.price||null,price_koef:this.item.price_koef||null,loops_count:this.item.loops_count||null},this.$emit("callback")},removeMessage(a){this.messages.splice(a,1)},submit(){let a=new FormData;Object.keys(this.form).forEach(e=>{const l=this.form[e]||"";typeof l=="object"?a.append(e,JSON.stringify(l)):a.append(e,l)}),this.$store.dispatch("storeSize",{sizeForm:a}).then(e=>{this.resetForm(),this.$emit("callback")}).catch(e=>{e.response?this.alert(e.response.data.message):this.alert("Ошибка")})}}},je=Object.assign(Fe,{__name:"SizeForm",setup(a){return(e,l)=>(i(),o(n,null,[s("form",{action:"",onSubmit:l[8]||(l[8]=B((...t)=>e.submit&&e.submit(...t),["prevent"]))},[s("div",K,[s("div",Q,[s("div",R,[p(s("input",{type:"number","onUpdate:modelValue":l[0]||(l[0]=t=>e.form.width=t),class:"form-control",id:"size-width",required:""},null,512),[[_,e.form.width]]),W])]),s("div",X,[s("div",Y,[p(s("input",{type:"number","onUpdate:modelValue":l[1]||(l[1]=t=>e.form.height=t),class:"form-control",id:"size-height",required:""},null,512),[[_,e.form.height]]),x])])]),s("div",I,[s("div",ee,[s("div",se,[p(s("input",{type:"number","onUpdate:modelValue":l[2]||(l[2]=t=>e.form.price=t),class:"form-control",id:"size-price",required:""},null,512),[[_,e.form.price]]),te])]),s("div",le,[s("div",ie,[p(s("input",{type:"number","onUpdate:modelValue":l[3]||(l[3]=t=>e.form.price_koef=t),step:"0.1",class:"form-control",id:"size-price-koef",required:""},null,512),[[_,e.form.price_koef]]),oe])])]),s("div",ae,[p(s("input",{type:"number","onUpdate:modelValue":l[4]||(l[4]=t=>e.form.loops_count=t),class:"form-control",id:"size-loops-count",placeholder:"name@example.com"},null,512),[[_,e.form.loops_count]]),re]),e.selectedMaterial?(i(),o("p",ne,[k("Вы выбрали материал: "),s("strong",null,g(e.selectedMaterial.title||"-"),1),s("a",{href:"javascript:void(0)",onClick:l[5]||(l[5]=(...t)=>e.removeSelectedMaterial&&e.removeSelectedMaterial(...t))},ce)])):d("",!0),s("button",{type:"button",class:"btn btn-outline-primary",onClick:l[6]||(l[6]=(...t)=>e.openMaterialModal&&e.openMaterialModal(...t))},[he,k(" Выберите материал ")]),s("div",ue,[s("div",me,[e.messages.length>0?(i(!0),o(n,{key:0},b(e.messages,(t,u)=>(i(),o("div",pe,[_e,k(" "+g(t||"Ошибка")+" ",1),s("button",{type:"button",class:"btn-close",onClick:m=>e.removeMessage(u)},null,8,fe)]))),256)):d("",!0)])]),s("div",be,[s("div",ge,[s("button",{disabled:!e.needClearForm||e.form.material_id==null,class:"btn btn-outline-success rounded-5"},[e.loading?(i(),o("span",ke)):(i(),o("i",ye)),k(" Сохранить размер ")],8,ve),e.needClearForm&&!e.loading?(i(),o("button",{key:0,type:"button",onClick:l[7]||(l[7]=(...t)=>e.resetForm&&e.resetForm(...t)),class:"btn btn-outline-danger rounded-5 ml-2"},[$e,k(" Очистить форму ")])):d("",!0)])])],32),s("div",Me,[s("div",we,[s("div",ze,[s("div",Se,[e.loadingMaterial?d("",!0):(i(),v(A,{key:0,onSelect:e.selectMaterial},null,8,["onSelect"]))]),Ce])])])],64))}}),Ve=D({__name:"PerfectScrollbar",props:{tag:{default:"div"},options:{default:()=>({})}},emits:["scroll","ps-scroll-y","ps-scroll-x","ps-scroll-up","ps-scroll-down","ps-scroll-left","ps-scroll-right","ps-y-reach-start","ps-y-reach-end","ps-x-reach-start","ps-x-reach-end"],setup(a,{expose:e,emit:l}){const t=a,u=l,m=V(null),r=V(null);E(()=>t.options,()=>{w(),h()},{deep:!0}),q(()=>{m.value&&h()}),N(()=>{w()});function h(){m.value&&(r.value=new G(m.value,t.options),z())}function w(){r.value&&(z(!1),r.value.destroy(),r.value=null)}const U={scroll:c("scroll"),"ps-scroll-y":c("ps-scroll-y"),"ps-scroll-x":c("ps-scroll-x"),"ps-scroll-up":c("ps-scroll-up"),"ps-scroll-down":c("ps-scroll-down"),"ps-scroll-left":c("ps-scroll-left"),"ps-scroll-right":c("ps-scroll-right"),"ps-y-reach-start":c("ps-y-reach-start"),"ps-y-reach-end":c("ps-y-reach-end"),"ps-x-reach-start":c("ps-x-reach-start"),"ps-x-reach-end":c("ps-x-reach-end")};function c(f){return function(y){u(f,y)}}function z(f=!0){var y;(y=r.value)!=null&&y.element&&Object.entries(U).forEach(([S,C])=>{var F,j;f?(F=r.value)==null||F.element.addEventListener(S,C):(j=r.value)==null||j.element.removeEventListener(S,C)})}return e({ps:r}),(f,y)=>(i(),v(J(f.tag),{ref_key:"scrollbar",ref:m,class:"ps"},{default:$(()=>[L(f.$slots,"default")]),_:3},512))}}),Oe={class:"row"},Pe={class:"col-12"},Ue=["onClick"],Te=s("td",{rowspan:"2",class:"table-side-column"},"Высота",-1),Be=s("td",{rowspan:"2",class:"table-side-column"},"Ширина",-1),De={key:0,colspan:"2",width:"200px",style:{"font-weight":"bold","text-align":"center",border:"1px solid #dadada"}},Ee=s("td",{width:"100px",style:{"font-weight":"bold","text-align":"center",border:"1px solid #dadada"}},"Цена ",-1),qe=s("td",{width:"100px",style:{"font-weight":"bold","text-align":"center",border:"1px solid #dadada"}}," Коэффициент ",-1),Ne={class:"table-side-column"},Le={class:"table-side-column"},Je={width:"100px",style:{"text-align":"center",border:"1px solid #dadada"}},Ze=["onChange","onUpdate:modelValue"],Ae={width:"100px",style:{"text-align":"center",border:"1px solid #dadada"}},Ge=["onChange","onUpdate:modelValue"],He={key:1,class:"alert alert-success my-3",role:"alert"},Ke=s("h4",{class:"alert-heading"},"Выберите материалы",-1),Qe=s("p",null,"Для отображения таблицы выберите интересующие материалы",-1),Re=[Ke,Qe],We={key:2,class:"alert alert-success my-3",role:"alert"},Xe=s("h4",{class:"alert-heading"},"Размеры",-1),Ye=s("p",null,"К сожалению, раздел размеров пуст. Вы еще не добавили ни одного размера, который можно отобразить на этой странице.",-1),xe=s("hr",null,null,-1),Ie=s("p",{class:"mb-0"},"Воспользуйтесь формой выше и добавьте свой первый размер",-1),es=[Xe,Ye,xe,Ie],ss={data(){return{materials:[],prices:[],selectedMaterials:[]}},mounted(){this.loadSizes()},methods:{toggleMaterialId(a){let e=this.selectedMaterials.findIndex(l=>l===a);e===-1?this.selectedMaterials.push(a):this.selectedMaterials.splice(e,1)},loadSizes(a=0){this.$store.dispatch("loadPreparedPrices").then(e=>{this.materials=e.materials,this.prices=e.prices,this.selectedMaterials=this.materials.map(l=>l.id)}).catch(()=>{})},saveParam(a,e,l){this.$store.dispatch("updateSizeParam",{dataObject:{id:this.prices[e].prices[l].id,key:a,value:this.prices[e].prices[l][a],height:this.prices[e].prices[l].height||null,width:this.prices[e].prices[l].width||null,material_id:this.prices[e].prices[l].material_id||null}}).then(t=>{this.prices[e].prices[l].id||(this.prices[e].prices[l].id=t.data.id),this.$notify({title:"DoDoors",text:"Параметры успешно обновлены"})}).catch(()=>{})}}},ts=Object.assign(ss,{__name:"SizeTable2",setup(a){return(e,l)=>(i(),o(n,null,[s("div",Oe,[s("div",Pe,[(i(!0),o(n,null,b(e.materials,t=>(i(),o("span",{class:M(["badge mr-2 cursor-pointer",{"bg-primary":e.selectedMaterials.indexOf(t.id)!=-1,"bg-secondary":e.selectedMaterials.indexOf(t.id)==-1}]),onClick:u=>e.toggleMaterialId(t.id)},g(t.title),11,Ue))),256))])]),e.prices.length>0&&e.selectedMaterials.length>0?(i(),v(P(Ve),{key:0,scrollTop:"",class:"py-2"},{default:$(()=>[s("table",null,[s("thead",null,[s("tr",null,[Te,Be,(i(!0),o(n,null,b(e.materials,t=>(i(),o(n,null,[e.selectedMaterials.indexOf(t.id)!=-1?(i(),o("td",De,g(t.title),1)):d("",!0)],64))),256))]),s("tr",null,[(i(!0),o(n,null,b(e.materials,t=>(i(),o(n,null,[e.selectedMaterials.indexOf(t.id)!=-1?(i(),o(n,{key:0},[Ee,qe],64)):d("",!0)],64))),256))])]),s("tbody",null,[(i(!0),o(n,null,b(e.prices,(t,u)=>(i(),o("tr",null,[s("td",Ne,[s("span",null,g(t.height),1)]),s("td",Le,[s("span",null,g(t.width),1)]),(i(!0),o(n,null,b(t.prices,(m,r)=>(i(),o(n,null,[e.selectedMaterials.indexOf(m.material_id)!=-1?(i(),o(n,{key:0},[s("td",Je,[p(s("input",{type:"text",onChange:h=>e.saveParam("price",u,r),style:{border:"1px #dadada solid"},"onUpdate:modelValue":h=>t.prices[r].price=h},null,40,Ze),[[_,t.prices[r].price]])]),s("td",Ae,[p(s("input",{type:"text",onChange:h=>e.saveParam("price_koef",u,r),style:{border:"1px #dadada solid"},"onUpdate:modelValue":h=>t.prices[r].price_koef=h},null,40,Ge),[[_,t.prices[r].price_koef]])])],64)):d("",!0)],64))),256))]))),256))])])]),_:1})):d("",!0),e.selectedMaterials.length===0?(i(),o("div",He,Re)):d("",!0),e.prices.length===0?(i(),o("div",We,es)):d("",!0)],64))}}),ls=s("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Размеры",-1),is={class:"py-12"},os={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},as={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},rs={class:"p-6 text-gray-900"},ns=s("hr",{class:"hr my-5"},null,-1),ds={class:"d-flex justify-center my-2"},cs={class:"nav nav-tabs"},hs={class:"nav-item"},us={class:"nav-item"},ms={data(){return{tab:0,loading:!1,selectedSize:null}},methods:{selectSize(a){this.selectedSize=a,this.loading=!0,this.$nextTick(()=>{this.loading=!1})},callbackSizeForm(){this.loading=!0,this.selectedSize=null,this.$nextTick(()=>{this.loading=!1})}}},Ms=Object.assign(ms,{__name:"SizesPage",setup(a){return(e,l)=>(i(),o(n,null,[O(P(Z),{title:"Размеры"}),O(T,null,{header:$(()=>[ls]),default:$(()=>[s("div",is,[s("div",os,[s("div",as,[s("div",rs,[e.loading?d("",!0):(i(),v(je,{key:0,item:e.selectedSize,onCallback:e.callbackSizeForm},null,8,["item","onCallback"])),ns,s("div",ds,[s("ul",cs,[s("li",hs,[s("a",{class:M(["nav-link",{active:e.tab===0}]),"aria-current":"page",onClick:l[0]||(l[0]=t=>e.tab=0),href:"javascript:void(0)"},"Таблица размеров",2)]),s("li",us,[s("a",{class:M(["nav-link",{active:e.tab===1}]),onClick:l[1]||(l[1]=t=>e.tab=1),href:"javascript:void(0)"},"Сводная таблица",2)])])]),e.tab===0?(i(),o(n,{key:1},[e.loading?d("",!0):(i(),v(H,{key:0,onSelect:e.selectSize},null,8,["onSelect"]))],64)):d("",!0),e.tab===1?(i(),v(ts,{key:2})):d("",!0)])])])])]),_:1})],64))}});export{Ms as default};
